(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{123:function(e){e.exports={name:"busy-hours",version:"0.0.1",description:"OpenStreetMap web editor for public transport hours",main:"src/index.js",scripts:{start:"react-scripts start",build:"react-scripts build",test:"react-scripts test",doc:"npm run doc:js:check && npm run doc:js","doc:js":"documentation build ./src -f html -o doc/","doc:js:check":"documentation lint ./src","i18n:build":"i18nline export","i18n:fix":"node fix_i18n_files.js","i18n:clean":"find ./src/config/locales -type f -not -name 'en.json' -delete",clean:"rm -rf build/*"},repository:{type:"git",url:"https://github.com/Jungle-Bus/Busy-Hours.git"},keywords:["openstreetmap","public transport","editor","osm","hours"],author:"Adrien PAVIE & Jungle Bus",license:"AGPL",dependencies:{"@date-io/date-fns":"^1.3.9","@material-ui/core":"^4.3.3","@material-ui/pickers":"^3.2.3","date-fns":"^2.0.0","fast-deep-equal":"^2.0.1",jungle_bus_web_components:"^1.0.1","mdi-react":"^5.4.0","object-hash":"^1.3.1","osm-auth":"^1.0.2","osm-request":"^1.2.5",osmtogeojson:"^3.0.0-beta.3","pubsub-js":"^1.7.0",react:"^16.9.0","react-dom":"^16.9.0","react-router-dom":"^5.0.1","react-scripts":"2.1.5","react-three-state-checkbox":"^1.2.2","transport-hours":"git+https://github.com/Jungle-Bus/transport-hours-js.git","typeface-roboto":"0.0.75",xml2js:"^0.4.19"},devDependencies:{assert:"^1.5.0",documentation:"^9.3.1",i18nline:"^2.0.1"},eslintConfig:{extends:"react-app"},browserslist:[">0.2%","not dead","not ie <= 11","not op_mini all"],i18n:{out:"src/config/locales/en.json",directories:["src/"]},homepage:"."}},150:function(e,t,n){e.exports=n(210)},207:function(e,t,n){var a={"./en.json":208,"./fr.json":209};function r(e){var t=i(e);return n(t)}function i(e){var t=a[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}r.keys=function(){return Object.keys(a)},r.resolve=i,e.exports=r,r.id=207},208:function(e){e.exports={en:{account_97b34646:"Account",add_a_new_interval_b58bcf2f:"Add a new interval",add_a_new_period_d1d36596:"Add a new period",an_error_happened_when_sending_your_changes_to_osm_332304c5:"An error happened when sending your changes to OSM server",busy_hours_is_a_public_transport_editor_for_openst_c14837b1:"Busy Hours is a public transport editor for OpenStreetMap. You can easily edit details of public transport lines.",can_t_open_in_josm_are_you_sure_remote_control_is__fcf03c1d:"Can't open in JOSM, are you sure remote control is enabled ?",cancel_all_2a4d9955:"Cancel all",cancel_caeb1e68:"Cancel",connect_to_openstreetmap_495dcc64:"Connect to OpenStreetMap",days_concerned_5a00ba35:"Days concerned",delete_this_interval_d9d29838:"Delete this interval",delete_this_period_e9497f77:"Delete this period",destination_dest_5ecc389d:"Destination : %{dest}",edit_hours_ee7c4bf6:"Edit hours",edit_in_editor_3583e504:"Edit in %{editor}",edit_in_external_editor_79f62d6a:"Edit in external editor",editor_uses_openstreetmap_accounts_please_connect__6f52788d:"%{editor} uses OpenStreetMap accounts. Please connect to OSM or create an account in order to be able to contribute.",from_fdd4956d:"From",from_from_c013a76b:"From : %{from}",hide_tags_45665e2a:"Hide tags",home_351838cd:"Home",hours_4f2f14d4:"Hours",interval_a623b202:"Interval",josm_d32c0521:"JOSM",key_f2a919d5:"Key",line_95da80eb:"Line",log_in_5c66644d:"Log In",log_out_379ba28a:"Log Out",login_or_create_account_b27ad227:"Login or create account",most_complete_one_d33156a0:"Most complete one",network_8a01975e:"Network",no_period_has_been_added_please_add_information_ab_aae69b8c:"No period has been added, please add information about this line opening hours",not_set_2f4a69c8:"not set",oops_openstreetmap_api_seems_unavailable_please_re_1319d946:"Oops ! OpenStreetMap API seems unavailable. Please retry a bit later.",oops_something_went_wrong_when_trying_to_log_you_i_97c911b6:"Oops ! Something went wrong when trying to log you in",opened_in_josm_d202a9b3:"Opened in JOSM",operator_6843fa48:"Operator",osm_api_can_t_retrieve_all_trips_associated_to_thi_e88ae404:"OSM API can't retrieve all trips associated to this line.",osm_server_is_not_able_to_create_a_changeset_for_n_12bb4530:"OSM server is not able to create a changeset for now",ph_90261b86:"PH",relation_id_ed99b2ad:"Relation ID",see_all_tags_aa10a074:"See all tags",see_on_osm_org_9f59682d:"See on OSM.org",see_relation_details_on_osm_8bb3c045:"See relation details on OSM",send_to_osm_d3627602:"Send to OSM",some_attributes_of_this_line_are_invalid_please_ch_e2e18454:"Some attributes of this line are invalid, please check and correct hours.",some_periods_are_incomplete_please_check_your_data_d4e1b887:"Some periods are incomplete, please check your data before uploading",the_given_relation_id_is_invalid_please_only_give__73f5c1ad:"The given relation ID is invalid. Please only give the number in the relation ID (example : 1234).",this_line_already_has_hours_defined_you_may_not_ne_3435711:"This line already has hours defined. You may not need to add hours on trips if they are similar.",this_line_has_no_interval_defined_but_its_opening__263eacba:"This line has no interval defined, but its opening hours are:",this_line_has_no_opening_hours_defined_existing_in_67f1d120:"This line has no opening hours defined, existing intervals are applied 24/7.",this_line_is_not_consistent_many_route_master_rela_78a084f9:"This line is not consistent : many route_master relations are associated to this line.",this_line_is_using_a_transport_mode_which_is_not_h_e494db10:"This line is using a transport mode which is not handled (maybe incorrect ?).",this_public_transport_route_is_not_available_on_os_c2aeeeae:"This public transport route is not available on OSM server",this_route_master_doesn_t_have_any_route_associate_bf270f58:"This route master doesn't have any route associated.",this_trip_belongs_to_line_line_if_all_trips_of_thi_9d2341b5:"This trip belongs to line %{line}. If all trips of this line have similar hours, please edit line information instead of trips ones.",to_51406be9:"To",to_start_enter_a_transport_line_relation_id_in_the_35c1b459:"To start, enter a transport line relation ID in the search field below.",trip_3298c126:"Trip",trips_6f46d983:"Trips",uploading_your_edits_afdea4b:"Uploading your edits",value_d842f16d:"Value",you_have_edited_this_line_hours_474481e7:"You have edited this line hours.",you_have_to_be_connected_before_sending_your_edits_7291c26a:"You have to be connected before sending your edits",you_have_to_be_connected_to_edit_line_hours_a099367:"You have to be connected to edit line hours",you_have_unsaved_edits_if_you_leave_these_edits_wi_d1172ce8:"You have unsaved edits, if you leave these edits will be lost. Are you sure you want to leave the page ?",your_edits_were_successfully_sent_to_osm_1828b68c:"Your edits were successfully sent to OSM"}}},209:function(e){e.exports={fr:{account_97b34646:"Compte",add_a_new_interval_b58bcf2f:"Ajouter une intervalle",add_a_new_period_d1d36596:"Ajouter une p\xe9riode",an_error_happened_when_sending_your_changes_to_osm_332304c5:"Une erreur est survenue en envoyant les changements sur le serveur OSM",busy_hours_is_a_public_transport_editor_for_openst_c14837b1:"Busy Hours est un \xe9diteur de donn\xe9es de transport dans OpenStreetMap. Vous pouvez y modifier facilement les informations des lignes de transport en commun.",can_t_open_in_josm_are_you_sure_remote_control_is__fcf03c1d:"Impossible de charger les donn\xe9es dans JOSM, est-ce que le contr\xf4le \xe0 distance est bien activ\xe9 ?",cancel_all_2a4d9955:"Annuler tout",cancel_caeb1e68:"Annuler",connect_to_openstreetmap_495dcc64:"Connexion \xe0 OpenStreetMap",days_concerned_5a00ba35:"Jours concern\xe9s",delete_this_interval_d9d29838:"Supprimer cette intervalle",delete_this_period_e9497f77:"Supprimer cette p\xe9riode",destination_dest_5ecc389d:"Destination : %{dest}",edit_hours_ee7c4bf6:"Modifier les horaires",edit_in_editor_3583e504:"Modifier dans %{editor}",edit_in_external_editor_79f62d6a:"Modifier dans un \xe9diteur externe",editor_uses_openstreetmap_accounts_please_connect__6f52788d:"%{editor} n\xe9cessite un compte OpenStreetMap. Veuillez vous connecter ou cr\xe9er un compte afin de contribuer.",from_fdd4956d:"De",from_from_c013a76b:"Origine : %{from}",hide_tags_45665e2a:"Masquer les tags",home_351838cd:"Accueil",hours_4f2f14d4:"Horaires",interval_a623b202:"Intervalle",josm_d32c0521:"JOSM",key_f2a919d5:"Clef",line_95da80eb:"Ligne",log_in_5c66644d:"Se connecter",log_out_379ba28a:"Se d\xe9connecter",login_or_create_account_b27ad227:"Se connecter ou cr\xe9er un compte",most_complete_one_d33156a0:"La plus compl\xe8te",network_8a01975e:"R\xe9seau",no_period_has_been_added_please_add_information_ab_aae69b8c:"Aucune p\xe9riode n'a \xe9t\xe9 ajout\xe9e, veuillez ajouter des informations sur les horaires de circulation de cette ligne",not_set_2f4a69c8:"non renseign\xe9",oops_openstreetmap_api_seems_unavailable_please_re_1319d946:"Oops ! Il y a un souci de connexion \xe0 l'API OpenStreetMap. Veuillez r\xe9essayer plus tard.",oops_something_went_wrong_when_trying_to_log_you_i_97c911b6:"Oops ! Quelque chose a mal tourn\xe9 quand vous avez tent\xe9 de vous connecter",opened_in_josm_d202a9b3:"Ouvert dans JOSM",operator_6843fa48:"Transporteur",osm_api_can_t_retrieve_all_trips_associated_to_thi_e88ae404:"Impossible de r\xe9cup\xe9rer tous les trajets associ\xe9s \xe0 cette ligne",osm_server_is_not_able_to_create_a_changeset_for_n_12bb4530:"Le serveur OSM n'a pas pu cr\xe9er un changeset pour le moment",ph_90261b86:"Jours f\xe9ri\xe9s",relation_id_ed99b2ad:"id de la relation",see_all_tags_aa10a074:"Voir tous les tags",see_on_osm_org_9f59682d:"Voir sur OSM.org",see_relation_details_on_osm_8bb3c045:"Voir les d\xe9tails de cette relation sur OSM",send_to_osm_d3627602:"Envoyer \xe0 OSM",some_attributes_of_this_line_are_invalid_please_ch_e2e18454:"Certains tags de cette ligne sont invalides, veuillez v\xe9rifier et corriger les horaires.",some_periods_are_incomplete_please_check_your_data_d4e1b887:"Certaines p\xe9riodes sont incompl\xe8tes, veuillez v\xe9rifier vos modifications avant l'envoi.",the_given_relation_id_is_invalid_please_only_give__73f5c1ad:"L'id de relation fourni est invalide. Veuillez indiquer uniquement le nombre dans le champ (exemple : 1234).",this_line_already_has_hours_defined_you_may_not_ne_3435711:"La ligne a d\xe9j\xe0 des horaires renseign\xe9s. Il n'est probablement pas n\xe9cessaire d'ajouter des horaires sur les trajets de la ligne.",this_line_has_no_interval_defined_but_its_opening__263eacba:"La ligne n'a pas de fr\xe9quence de passage renseign\xe9e, mais ses horaires de circulation sont :",this_line_has_no_opening_hours_defined_existing_in_67f1d120:"La ligne n'a pas d'horaires de circulation renseign\xe9s, la fr\xe9quence de passage a \xe9t\xe9 appliqu\xe9e 24/7.",this_line_is_not_consistent_many_route_master_rela_78a084f9:"La ligne est invalide : plusieurs relations de type route_master correspondent.",this_line_is_using_a_transport_mode_which_is_not_h_e494db10:"La ligne a un mode de transport inconnu (peut-\xeatre est-il incorrect ?).",this_public_transport_route_is_not_available_on_os_c2aeeeae:"Cette ligne de transport n'est pas disponible sur le serveur OSM",this_route_master_doesn_t_have_any_route_associate_bf270f58:"Cette ligne (relation route_master) n'a aucun trajet (relation route) associ\xe9.",this_trip_belongs_to_line_line_if_all_trips_of_thi_9d2341b5:"Ce trajet appartient \xe0 la ligne %{line}. Si tous les trajets ont des fr\xe9quences de passage similaires, merci d'ajouter les horaires sur la ligne plut\xf4t que sur le trajet. ",to_51406be9:"\xc0",to_start_enter_a_transport_line_relation_id_in_the_35c1b459:"Pour commencer, entrez l'id de relation d'une ligne de transport dans le champ ci-dessous",trip_3298c126:"Trajet",trips_6f46d983:"Trajets",uploading_your_edits_afdea4b:"Envoi de vos modifications",value_d842f16d:"Valeur",you_have_edited_this_line_hours_474481e7:"Vous avez modifi\xe9 les horaires de cette ligne.",you_have_to_be_connected_before_sending_your_edits_7291c26a:"Vous devez \xeatre connect\xe9 pour envoyer vos modifications",you_have_to_be_connected_to_edit_line_hours_a099367:"Vous devez \xeatre connect\xe9 pour modifier les horaires de la ligne",you_have_unsaved_edits_if_you_leave_these_edits_wi_d1172ce8:"Vous avez des modifications non envoy\xe9es qui seront perdues si vous partez. \xcates-vous s\xfbr de vouloir quitter cette page ?",your_edits_were_successfully_sent_to_osm_1828b68c:"Vos modifications ont \xe9t\xe9 envoy\xe9es avec succ\xe8s \xe0 OSM"}}},210:function(e,t,n){"use strict";n.r(t);var a=n(10),r=n(11),i=n(0),o=n.n(i),s=n(15),l=n.n(s),c=n(13),u=n(12),d=n(14),p=n(21),_=n(40),h=(n(155),n(156),n(127)),m=n(285),f=n(115),b=n(99),g=n.n(b),v=n(256),y=n(18),E=n.n(y),w=n(296),O=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={duration:5e3,message:"",type:"info",open:!1},E.a.subscribe("UI.MESSAGE.BASIC",function(t,n){e.setState({message:n.message+(n.details?" ("+n.details+")":""),duration:n.duration||(n.details?7e3:5e3),type:n.type||"info",open:!0})}),e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(w.a,{open:this.state.open,autoHideDuration:this.state.duration,onClose:function(){return e.setState({open:!1})},message:this.state.message,action:[o.a.createElement(v.a,{key:"close",onClick:function(){return e.setState({open:!1})},color:"inherit"},o.a.createElement(g.a,null))]})}}]),t}(i.Component),j=n(286),k=n(258),S=n(6),T=n.n(S),C=n(100),A=n.n(C),D=n(101),I=n.n(D),M=n(257),P=n(29),L=n(102),x=n.n(L),R=n(254),U=n(104),N=n.n(U),H=n(59),V=n.n(H),Y=n(103),B={error:n.n(Y).a[600],warning:V.a[600],info:N.a[600]},J={error:I.a,warning:A.a,info:x.a},G=function(e){function t(){return Object(a.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props.level||"info",t=this.props.icon||o.a.createElement(J[e],{style:{verticalAlign:"middle"}}),n=this.props.relationId||null;return o.a.createElement(R.a,{message:o.a.createElement("div",null,t," ",this.props.message),style:{backgroundColor:B[e],color:"white",verticalAlign:"middle",margin:10},action:n?[o.a.createElement(M.a,{key:"osm",target:"_blank",color:"inherit",href:P.osm_api_url+"/relation/"+n},T.a.t("See relation details on OSM"))]:null})}}]),t}(i.Component),z={cant_get_trips:T.a.t("OSM API can't retrieve all trips associated to this line."),many_route_masters:T.a.t("This line is not consistent : many route_master relations are associated to this line."),invalid_mode:T.a.t("This line is using a transport mode which is not handled (maybe incorrect ?)."),no_trips:T.a.t("This route master doesn't have any route associated.")},q=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={loading:!0,error:!1},e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props.match.params.rid;return o.a.createElement("div",{style:{textAlign:"center",padding:30}},this.state.loading&&o.a.createElement(k.a,{size:50}),this.state.error&&z[this.state.error]&&o.a.createElement(G,{message:z[this.state.error],relationId:e,level:"error"}),"invalid_id"===this.state.error&&o.a.createElement(G,{message:T.a.t("The given relation ID is invalid. Please only give the number in the relation ID (example : 1234)."),level:"warning"}),"api_failed"===this.state.error&&o.a.createElement(G,{message:T.a.t("Oops ! OpenStreetMap API seems unavailable. Please retry a bit later."),level:"error"}))}},{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.rid;isNaN(parseInt(t))?this.setState({loading:!1,error:"invalid_id"}):(this.setState({loading:!0,error:!1}),this.props.dataManager.loadDataFromRelation("relation/"+t).then(function(n){e.setState({loading:!1,error:!1}),e.props.onDataLoaded(n);var a=Object.keys(n);if(a.length>0){var r=a.includes(t)?"/line/"+t:"/line/"+a[0]+"/trip/"+t;e.props.history.location.pathname!==r&&e.props.history.push(r)}}).catch(function(t){e.setState({loading:!1,error:z[t]?t:"api_failed"}),console.error(t)}))}}]),t}(i.Component),F=Object(_.g)(q),W=n(126),$=n(119),K=n.n($),X=n(264),Q=n(265),Z=n(42),ee=n(106),te=n.n(ee),ne=n(107),ae=n.n(ne),re=n(108),ie=n.n(re),oe=n(263),se=n(128),le=n(262),ce=n(294),ue=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={connected:!1,user:null,menuOpen:!1,menuAnchor:null},e.psTokens={},e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"_closeMenu",value:function(){this.setState({menuOpen:!1,menuAnchor:null})}},{key:"_logoutClick",value:function(){E.a.publish("APP.USER.LOGOUT"),this._closeMenu(),this.setState({connected:!1,user:null})}},{key:"render",value:function(){var e=this;return this.state.connected?o.a.createElement("div",{style:{display:"inline"}},o.a.createElement(ce.a,{title:T.a.t("Account"),placement:"bottom"},o.a.createElement(v.a,{color:"inherit",onClick:function(t){return e.setState({menuOpen:!0,menuAnchor:t.currentTarget})}},o.a.createElement(ae.a,null))),o.a.createElement(se.a,{anchorEl:this.state.menuAnchor,open:this.state.menuOpen,onClose:this._closeMenu.bind(this)},o.a.createElement(le.a,{disabled:!0},this.state.user),o.a.createElement(le.a,{onClick:this._logoutClick.bind(this)},o.a.createElement(oe.a,null,o.a.createElement(ie.a,null)),o.a.createElement(Z.a,{variant:"inherit"},T.a.t("Log Out"))))):o.a.createElement(ce.a,{title:T.a.t("Log In"),placement:"bottom"},o.a.createElement(M.a,{color:"inherit",onClick:function(){return E.a.publish("APP.USER.WANTSLOGIN")}},o.a.createElement(te.a,null),T.a.t("Log In")))}},{key:"componentWillMount",value:function(){var e=this;this.psTokens.login=E.a.subscribe("APP.USER.READY",function(t,n){e.setState({user:n.username,connected:!0})})}},{key:"componentWillUnmount",value:function(){this.psTokens.login&&E.a.unsubscribe(this.psTokens.login)}}]),t}(i.Component),de=function(e){function t(){return Object(a.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return o.a.createElement(X.a,{position:"static",style:{backgroundColor:"#0267b1"}},o.a.createElement(Q.a,{style:{justifyContent:"space-between"}},o.a.createElement("div",null,o.a.createElement("img",{src:"header.png",height:64,title:window.EDITOR_NAME,alt:"",style:{verticalAlign:"middle",marginRight:10}}),o.a.createElement(Z.a,{variant:"h6",style:{display:"inline-block"}},window.EDITOR_NAME)),o.a.createElement(ue,null)))}}]),t}(i.Component),pe=n(73),_e=n(110),he=n.n(_e),me=n(71),fe=n.n(me),be=n(111),ge=n.n(be),ve=n(112),ye=n.n(ve),Ee=n(58),we=n.n(Ee),Oe=n(273),je=n(86),ke=n(113),Se=n.n(ke),Te=n(291),Ce=n(268),Ae=n(269),De=n(266),Ie=n(267),Me=function(e){function t(){return Object(a.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"_getWeekDays",value:function(e){for(var t=new Date(Date.UTC(2017,0,2)),n=[],a=0;a<7;a++)n.push({val:t.toLocaleDateString("en-GB",{weekday:"long"}).substring(0,2).toLowerCase(),lbl:t.toLocaleDateString(e,{weekday:"short"})}),t.setDate(t.getDate()+1);return n.push({val:"ph",lbl:T.a.t("PH")}),n}},{key:"_onChange",value:function(e){var t=e.target.value,n=this.props.selection.slice(0);this.props.selection.includes(t)?n=n.filter(function(e){return e!==t}):n.push(t),this.setState({selected:n}),this.props.onChange&&this.props.onChange(n)}},{key:"render",value:function(){var e=this,t=this._getWeekDays(T.a.locale);return o.a.createElement(De.a,{component:"fieldset"},o.a.createElement(Ie.a,{component:"legend"},this.props.label),o.a.createElement(Ce.a,{value:this.props.value,onChange:function(t){return e._onChange(t)},row:!0,style:{marginTop:5}},t.map(function(t){return o.a.createElement(Ae.a,{key:t.val,value:t.val,control:o.a.createElement(Te.a,{color:"primary"}),label:t.lbl,labelPlacement:"top",style:{margin:0},checked:e.props.selection.includes(t.val)})})))}}]),t}(i.Component),Pe=n(114),Le=n.n(Pe),xe=n(272),Re=n(289),Ue=n(287),Ne=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={fromDate:null,toDate:null,interval:""},e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e={};this.props.fromHour&&(e.fromDate=this._hourStringToDateObj(this.props.fromHour)),this.props.toHour&&(e.toDate=this._hourStringToDateObj(this.props.toHour)),this.props.interval&&(e.interval=this.props.interval),this.setState(e)}},{key:"componentDidUpdate",value:function(e){var t={};e.fromHour!==this.props.fromHour&&(t.fromDate=this._hourStringToDateObj(this.props.fromHour)),e.toHour!==this.props.toHour&&(t.toDate=this._hourStringToDateObj(this.props.toHour)),e.interval!==this.props.interval&&(t.interval=this.props.interval),Object.keys(t).length>0&&this.setState(t)}},{key:"_hourStringToDateObj",value:function(e){return e?new Date("1970-01-01T"+e+":00"):null}},{key:"_onChange",value:function(e,t){var n=this;this._callOnChange&&(clearTimeout(this._callOnChange),delete this._callOnChange);var a=Object.assign({},this.state);a[e]=t,a.fromDate instanceof Date&&a.toDate instanceof Date&&!isNaN(parseInt(a.interval))?this._callOnChange=setTimeout(function(){var e=a.fromDate.toTimeString().substring(0,5),t=a.toDate.toTimeString().substring(0,5);n.props.onChange(e+"-"+t,parseInt(a.interval))},1e3):this.props.onInvalid(),this.setState(a)}},{key:"render",value:function(){var e=this;return o.a.createElement(De.a,{component:"fieldset",style:{display:"block"}},o.a.createElement(Ce.a,{value:this.props.value,row:!0,style:{marginTop:5,display:"flex",justifyContent:"space-between"}},o.a.createElement(Ue.a,{ampm:!1,initialFocusedDate:new Date("1970-01-01T00:00:00"),value:this.state.fromDate,label:T.a.t("From"),style:{width:80},onChange:function(t){return e._onChange("fromDate",t)}}),o.a.createElement(Ue.a,{ampm:!1,initialFocusedDate:new Date("1970-01-01T00:00:00"),value:this.state.toDate,label:T.a.t("To"),style:{marginRight:20,marginLeft:20,width:80},onChange:function(t){return e._onChange("toDate",t)}}),o.a.createElement(Re.a,{label:T.a.t("Interval"),value:this.state.interval,placeholder:"42",type:"number",InputProps:{endAdornment:o.a.createElement(xe.a,{position:"end"},"min")},style:{width:150},onChange:function(t){return e._onChange("interval",t.target.value)}}),o.a.createElement(v.a,{title:T.a.t("Delete this interval"),size:"small",style:{marginLeft:10},onClick:function(){return e.props.onDelete()}},o.a.createElement(Le.a,null))))}}]),t}(i.Component),He=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={days:[],intervals:null,showEmptyInterval:!1},e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"_onDaysChanged",value:function(e){var t=this;this.setState({days:e},function(){return t._notityParent()})}},{key:"_notityParent",value:function(){!this.state.showEmptyInterval&&this.state.days.length>0&&this.state.intervals&&Object.keys(this.state.intervals).length>0&&0===Object.entries(this.state.intervals).filter(function(e){return!e[0].match(/^\d{2}:\d{2}-\d{2}:\d{2}$/)||isNaN(e[1])}).length?this.props.onValid({days:this.state.days,intervals:this.state.intervals}):(console.log("invalid",this.state),this.props.onInvalid())}},{key:"_editInterval",value:function(e,t,n){var a=this,r=null===this.state.intervals?{}:Object.assign({},this.state.intervals);e&&delete r[e],t&&(r[t]=n||null),this.setState({intervals:Object.keys(r).length>0?r:null},function(){return a._notityParent()})}},{key:"render",value:function(){var e=this,t=this.state.intervals?Object.entries(this.state.intervals).sort(function(e,t){return e[0].localeCompare(t[0])}):[];return o.a.createElement(Oe.a,{container:!0,alignItems:"center"},o.a.createElement(Oe.a,{item:!0,xs:12,sm:6},o.a.createElement(Me,{label:T.a.t("Days concerned"),selection:this.state.days,onChange:function(t){return e._onDaysChanged(t)}}),o.a.createElement(M.a,{style:{marginTop:10},onClick:function(){return e.props.onDelete()}},o.a.createElement(Se.a,null)," ",T.a.t("Delete this period"))),o.a.createElement(Oe.a,{item:!0,xs:12,sm:6},t.map(function(t,n){var a=Object(pe.a)(t,2),r=a[0],i=a[1];return o.a.createElement(Ne,{fromHour:r.split("-")[0],toHour:r.split("-")[1],interval:i,key:n,onChange:function(t,n){return e._editInterval(r,t,n)},onDelete:function(){return e._editInterval(r)},onInvalid:function(){return e.props.onInvalid()}})}),this.state.showEmptyInterval&&o.a.createElement(Ne,{fromHour:t.length>0?t[t.length-1][0].split("-")[1]:null,onChange:function(t,n){e.setState({showEmptyInterval:!1},function(){e._editInterval(null,t,n)})},onDelete:function(){return e.setState({showEmptyInterval:!1})},onInvalid:function(){return e.props.onInvalid()}}),o.a.createElement(M.a,{color:"secondary",style:{marginTop:10},onClick:function(){e.props.onInvalid(),e.setState({showEmptyInterval:!0})}},o.a.createElement(fe.a,null)," ",T.a.t("Add a new interval"))))}},{key:"componentDidMount",value:function(){this.props.period&&this.setState(this.props.period)}},{key:"componentDidUpdate",value:function(e){this.props.period?(e.period&&e.period.days&&we()(e.period.days,this.props.period.days)||this.setState({days:this.props.period.days}),e.period&&e.period.intervals&&we()(e.period.intervals,this.props.period.intervals)||this.setState({intervals:this.props.period.intervals})):this.setState({days:[],intervals:{}})}}]),t}(i.Component),Ve={days:["mo","tu","we","th","fr"],intervals:{}},Ye=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={periods:null,alert:null,notConnectedAlert:!1,uploading:!1},e._busyPeriods=new Set,e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"_getPeriods",value:function(e){return this.state.periods||Array.isArray(this.props.linetrip.allComputedIntervals)&&this.props.linetrip.allComputedIntervals||(e?[Ve]:[])}},{key:"_copyPeriods",value:function(e){return e.slice(0).map(function(e){var t=Object.assign({},e);return t.days=e.days.slice(0),t.intervals=Object.assign({},e.intervals),t})}},{key:"_addPeriod",value:function(){if(!window.editor_user||!window.editor_user_auth)return null;var e=this._copyPeriods(this._getPeriods());if(0===e.length)this._busyPeriods.add(0),this.props.onEdit([Ve]);else{var t=["mo","tu","we","th","fr","sa","su","ph"];e.forEach(function(e){e.days.forEach(function(e){var n=t.indexOf(e);n>=0&&t.splice(n,1)})}),e.push({days:t.length>0?[t[0]]:[],intervals:{}}),this._busyPeriods.add(e.length-1),this.props.onEdit(e)}}},{key:"_updatePeriod",value:function(e,t){if(!window.editor_user||!window.editor_user_auth)return null;var n=this._copyPeriods(this._getPeriods());n[e]&&(n[e]=t,this._busyPeriods.delete(e),this.props.onEdit(n))}},{key:"_busyPeriod",value:function(e){this._busyPeriods.add(e)}},{key:"_deletePeriod",value:function(e){if(!window.editor_user||!window.editor_user_auth)return null;var t=this._copyPeriods(this._getPeriods());t[e]&&(t.splice(e,1),this._busyPeriods.delete(e),this.props.onEdit(t))}},{key:"_onSend",value:function(){var e=this;this._busyPeriods.size>0?E.a.publish("UI.MESSAGE.BASIC",{message:T.a.t("Some periods are incomplete, please check your data before uploading")}):0===this.state.periods.length?E.a.publish("UI.MESSAGE.BASIC",{message:T.a.t("No period has been added, please add information about this line opening hours")}):this.state.periods&&this.props.dataManager&&(this.setState({uploading:!0}),this.props.dataManager.saveRelationPeriods("relation/"+this.props.relid,this.state.periods).then(function(){e.props.onEdit(null),e.setState({periods:null,uploading:!1},function(){alert(T.a.t("Your edits were successfully sent to OSM")),e.props.history.push("/load/"+e.props.relid)})}).catch(function(t){var n=t.message?t.message:t.toString();"not_connected"===n?n=T.a.t("You have to be connected before sending your edits"):"changeset_failed"===n?n=T.a.t("OSM server is not able to create a changeset for now"):"cant_find_relation"===n?n=T.a.t("This public transport route is not available on OSM server"):"sending_failed"===n&&(n=T.a.t("An error happened when sending your changes to OSM server")),e.setState({uploading:!1,alert:{message:n}},function(){setTimeout(function(){return e.setState({alert:null})},5e3)})}))}},{key:"_onCancel",value:function(){this.setState({periods:null}),this._busyPeriods.clear(),this.props.onEdit(null)}},{key:"render",value:function(){var e=this;if(this.state.uploading)return o.a.createElement("div",{style:{marginTop:10,textAlign:"center"}},o.a.createElement(k.a,{style:{verticalAlign:"middle",marginRight:10}})," ",T.a.t("Uploading your edits"));var t=this._getPeriods();return o.a.createElement("div",{style:{marginTop:10}},this.state.alert&&o.a.createElement(G,{level:this.state.alert.level||"warning",message:this.state.alert.message}),window.editor_user&&window.editor_user_auth&&this.state.periods&&o.a.createElement(Oe.a,{container:!0,alignItems:"center",spacing:2,style:{marginBottom:10}},o.a.createElement(Oe.a,{item:!0,xs:12,sm:6},T.a.t("You have edited this line hours.")),o.a.createElement(Oe.a,{item:!0,xs:6,sm:3},o.a.createElement(M.a,{variant:"contained",color:"primary",style:{width:"100%"},onClick:function(){return e._onSend()}},o.a.createElement(ye.a,null)," ",T.a.t("Send to OSM"))),o.a.createElement(Oe.a,{item:!0,xs:6,sm:3},o.a.createElement(M.a,{variant:"contained",color:"secondary",style:{width:"100%"},onClick:function(){return e._onCancel()}},o.a.createElement(ge.a,null)," ",T.a.t("Cancel all")))),t&&t.map(function(t,n){return o.a.createElement(je.a,{style:{padding:10,marginBottom:20},key:n},o.a.createElement(He,{period:t,onValid:function(t){return e._updatePeriod(n,t)},onInvalid:function(){return e._busyPeriod(n)},onDelete:function(){return e._deletePeriod(n)}}))}),o.a.createElement(M.a,{color:"secondary",style:{marginTop:10},onClick:function(){return e._addPeriod()}},o.a.createElement(fe.a,null)," ",T.a.t("Add a new period")))}},{key:"componentDidMount",value:function(){var e=this;this.props.editedPeriods&&this.setState({periods:this.props.editedPeriods}),window.editor_user&&window.editor_user_auth||this.setState({alert:{level:"info",message:T.a.t("You have to be connected to edit line hours")},notConnectedAlert:!0}),this.psTokenLogin=E.a.subscribe("APP.USER.READY",function(t,n){n&&e.state.notConnectedAlert&&e.setState({alert:null,notConnectedAlert:!1})}),this.psTokenLogout=E.a.subscribe("APP.USER.LOGOUT",function(t,n){e.state.notConnectedAlert||e.setState({alert:{level:"info",message:T.a.t("You have to be connected to edit line hours")},notConnectedAlert:!0})})}},{key:"componentDidUpdate",value:function(e){we()(this.props.editedPeriods,this.state.periods)||this.setState({periods:this.props.editedPeriods}),this.state.notConnectedAlert||window.editor_user&&window.editor_user_auth||this.setState({alert:{level:"info",message:T.a.t("You have to be connected to edit line hours")},notConnectedAlert:!0}),this.state.notConnectedAlert&&window.editor_user&&window.editor_user_auth&&this.setState({alert:null,notConnectedAlert:!1})}},{key:"componentWillUnmount",value:function(){this.psTokenLogin&&E.a.unsubscribe("APP.USER.READY",this.psTokenLogin),this.psTokenLogout&&E.a.unsubscribe("APP.USER.LOGOUT",this.psTokenLogout)}}]),t}(i.Component),Be=Object(_.g)(Ye),Je=n(261),Ge=n(212),ze=n(276),qe=n(275),Fe=n(277),We=n(290),$e=n(274),Ke=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={tab:0},e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this,t=this.props.selectedLine&&this.props.lines&&this.props.lines[this.props.selectedLine]?this.props.lines[this.props.selectedLine]:null,n=t&&this.props.selectedTrip&&t.trips[this.props.selectedTrip]?t.trips[this.props.selectedTrip]:null;return o.a.createElement("div",null,o.a.createElement(We.a,{value:n?0:this.state.tab,onChange:function(t,n){return e.setState({tab:n})},indicatorColor:"primary",textColor:"primary"},o.a.createElement($e.a,{label:T.a.t("Hours")}),!n&&t.trips&&o.a.createElement($e.a,{label:T.a.t("Trips")})),(!n&&0===this.state.tab||n)&&o.a.createElement("div",null,n&&o.a.createElement(G,{message:T.a.t("This trip belongs to line %{line}. If all trips of this line have similar hours, please edit line information instead of trips ones.",{line:t.ref})}),o.a.createElement(Be,{linetrip:n||t,relid:n?this.props.selectedTrip:this.props.selectedLine,dataManager:this.props.dataManager,editedPeriods:this.props.edits,onEdit:function(t){return e.props.onEdit(t)}})),!n&&1===this.state.tab&&o.a.createElement("div",null,(t.opening_hours||t.interval)&&o.a.createElement(G,{message:T.a.t("This line already has hours defined. You may not need to add hours on trips if they are similar.")}),o.a.createElement(Je.a,null,Object.entries(t.trips).map(function(n){var a=Object(pe.a)(n,2),r=a[0],i=a[1];return o.a.createElement(Ge.a,{key:r},o.a.createElement(qe.a,null,o.a.createElement("transport-thumbnail",{"data-transport-mode":t.type,"data-transport-line-code":i.ref||t.ref,"data-transport-line-color":i.colour||t.colour})),o.a.createElement(ze.a,{primary:T.a.t("Destination : %{dest}",{dest:i.to}),secondary:T.a.t("From : %{from}",{from:i.from})}),o.a.createElement(Fe.a,null,o.a.createElement(M.a,{edge:"end",color:"secondary",component:p.b,to:"/line/"+e.props.selectedLine+"/trip/"+r},o.a.createElement(he.a,null)," ",T.a.t("Edit hours"))))}))))}}]),t}(i.Component),Xe=n(292),Qe=function(e){function t(){return Object(a.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props.selectedLine&&this.props.lines&&this.props.lines[this.props.selectedLine]?this.props.lines[this.props.selectedLine]:null,t=e&&this.props.selectedTrip&&e.trips[this.props.selectedTrip]?e.trips[this.props.selectedTrip]:null,n={textDecoration:"none",color:"inherit"};return o.a.createElement(je.a,{style:{padding:10}},o.a.createElement(Xe.a,{separator:" / ","aria-label":"Breadcrumb",style:{display:"flex",justifyContent:"center"}},o.a.createElement(p.b,{to:"/",style:n},T.a.t("Home")),e&&e.rawTags.route_master&&o.a.createElement(p.b,{to:"/line/"+this.props.selectedLine,style:n},T.a.t("Line"),o.a.createElement("transport-thumbnail",{"data-transport-mode":e.type,"data-transport-line-code":e.ref,"data-transport-line-color":e.colour})),e&&!e.rawTags.route_master&&!t&&o.a.createElement(p.b,{to:"/line/"+this.props.selectedLine,style:n},T.a.t("Trip"),o.a.createElement("transport-thumbnail",{"data-transport-mode":e.type,"data-transport-line-code":e.ref,"data-transport-line-color":e.colour,"data-transport-destination":e.to})),e&&t&&o.a.createElement(p.b,{to:"/line/"+this.props.selectedLine+"/trip/"+this.props.selectedTrip,style:n},T.a.t("Trip"),o.a.createElement("transport-thumbnail",{"data-transport-mode":e.type,"data-transport-line-code":e.ref,"data-transport-line-color":e.colour,"data-transport-destination":t.to}))))}}]),t}(i.Component);Math.toRadians=function(e){return e*Math.PI/180},Math.toDegrees=function(e){return 180*e/Math.PI};var Ze=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={open:!1,anchor:!1},e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"_onClose",value:function(){this.setState({open:!1,anchor:null})}},{key:"_editJOSM",value:function(){var e="http://localhost:8111/load_object?";this.props.relation&&(e+="&objects=r"+this.props.relation+"&relation_members=true"),fetch(e).then(function(e){E.a.publish("UI.MESSAGE.BASIC",{type:"info",message:T.a.t("Opened in JOSM")})}).catch(function(e){console.error(e),E.a.publish("UI.MESSAGE.BASIC",{type:"error",message:T.a.t("Can't open in JOSM, are you sure remote control is enabled ?")})})}},{key:"_editId",value:function(){var e="https://openstreetmap.org/edit#",t={hashtags:"#"+window.EDITOR_NAME.replace(/ /g,"_")};this.props.relation&&(t.id="r"+this.props.relation),e+=Object.entries(t).map(function(e){return e[0]+"="+encodeURIComponent(e[1])}).join("&"),window.open(e,"_blank").focus()}},{key:"_click",value:function(e){switch(this._onClose(),e){case"id":this._editId();break;case"josm":this._editJOSM()}}},{key:"render",value:function(){var e=this,t=[{id:"josm",name:T.a.t("JOSM"),tip:T.a.t("Most complete one")}];return o.a.createElement("div",{style:{display:"inline-block"}},o.a.createElement(M.a,{onClick:function(n){t.length>1?e.setState({open:!0,anchor:n.currentTarget}):e._click(t[0].id)}},t.length>1?T.a.t("Edit in external editor"):T.a.t("Edit in %{editor}",{editor:t[0].name})),t.length>1&&this.state.anchor&&o.a.createElement(se.a,{id:"editors-menu",anchorEl:this.state.anchor,open:this.state.open,keepMounted:!0,onClose:function(){return e._onClose()}},t.map(function(t){return o.a.createElement(le.a,{key:t.id,onClick:function(){return e._click(t.id)}},o.a.createElement(ze.a,{primary:t.name,secondary:t.tip}))})))}}]),t}(i.Component),et=n(278),tt=n(282),nt=n(281),at=n(279),rt=n(280),it=function(e){function t(){return Object(a.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return o.a.createElement(je.a,{style:Object.assign({overflowX:"auto"},this.props.style)},o.a.createElement(et.a,null,o.a.createElement(at.a,null,o.a.createElement(rt.a,null,o.a.createElement(nt.a,null,T.a.t("Key")),o.a.createElement(nt.a,null,T.a.t("Value")))),o.a.createElement(tt.a,null,Object.entries(this.props.tags).map(function(e,t){return o.a.createElement(rt.a,{key:t},o.a.createElement(nt.a,null,e[0]),o.a.createElement(nt.a,null,e[1]))}))))}}]),t}(i.Component),ot=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={showTags:!1},e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this,t=this.props.selectedLine&&this.props.lines&&this.props.lines[this.props.selectedLine]?this.props.lines[this.props.selectedLine]:null,n=t&&this.props.selectedTrip&&t.trips[this.props.selectedTrip]?t.trips[this.props.selectedTrip]:null,a=n||t;return o.a.createElement("div",null,o.a.createElement("h2",null,o.a.createElement("transport-thumbnail",{"data-transport-mode":t.type,"data-transport-line-code":t.ref,"data-transport-line-color":t.colour}),n?n.name:t.name),o.a.createElement("ul",null,o.a.createElement("li",null,T.a.t("Network")+" : "+(t.network?t.network:T.a.t("not set"))),o.a.createElement("li",null,T.a.t("Operator")+" : "+(t.operator?t.operator:T.a.t("not set")))),a&&!isNaN(a.defaultInterval)&&"unset"===a.opens&&o.a.createElement(G,{message:T.a.t("This line has no opening hours defined, existing intervals are applied 24/7.")}),a&&"unset"===a.defaultInterval&&"unset"===a.otherIntervals&&"object"===typeof a.opens&&o.a.createElement(G,{message:T.a.t("This line has no interval defined, but its opening hours are:")+" "+a.rawTags.opening_hours}),a&&("invalid"===a.defaultInterval||"invalid"===a.otherIntervals||"invalid"===a.opens)&&o.a.createElement(G,{level:"warning",message:T.a.t("Some attributes of this line are invalid, please check and correct hours.")}),this.state.showTags&&o.a.createElement(it,{tags:n?n.rawTags:t.rawTags,style:{marginBottom:20}}),o.a.createElement("div",{style:{textAlign:"right"}},o.a.createElement(M.a,{onClick:function(){return e.setState({showTags:!e.state.showTags})}},this.state.showTags?T.a.t("Hide tags"):T.a.t("See all tags")),o.a.createElement(M.a,{href:P.osm_api_url+"/relation/"+(n?this.props.selectedTrip:this.props.selectedLine),target:"_blank"},T.a.t("See on OSM.org")),o.a.createElement(Ze,{relation:this.props.selectedTrip||this.props.selectedLine})))}}]),t}(i.Component),st=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={edits:null},e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this,t=Object.assign({},this.props,{selectedLine:this.props.match.params.lid,selectedTrip:this.props.match.params.tid});return t.selectedLine&&t.lines&&t.lines[t.selectedLine]?o.a.createElement("div",null,o.a.createElement(_.a,{when:null!==this.state.edits,message:T.a.t("You have unsaved edits, if you leave these edits will be lost. Are you sure you want to leave the page ?")}),o.a.createElement(Qe,t),o.a.createElement(ot,t),o.a.createElement(Ke,Object.assign({},t,{edits:this.state.edits,onEdit:function(t){return e.setState({edits:t})}}))):o.a.createElement("div",null)}},{key:"_checkDataLoaded",value:function(){this.props.match.params.lid&&this.props.lines&&this.props.lines[this.props.match.params.lid]||this.props.history.push("/load/"+this.props.match.params.lid)}},{key:"componentDidMount",value:function(){this._checkDataLoaded()}},{key:"componentDidUpdate",value:function(){this._checkDataLoaded()}}]),t}(i.Component),lt=Object(_.g)(st),ct=n(293),ut=n(271),dt=n(270),pt=n(284),_t=n(283),ht=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={open:!1},E.a.subscribe("APP.USER.WANTSLOGIN",function(t,n){n=n||{},e.setState({open:!0})}),e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"_loginClicked",value:function(){E.a.publish("APP.USER.LOGIN"),this._closeDialog(!1)}},{key:"_closeDialog",value:function(e){this.setState({open:!1}),e&&this.props.history&&this.props.history.push("/")}},{key:"render",value:function(){var e=this;return o.a.createElement(ct.a,{open:this.state.open,onClose:function(){return e._closeDialog(!0)}},o.a.createElement(_t.a,null,T.a.t("Connect to OpenStreetMap")),o.a.createElement(dt.a,null,o.a.createElement(pt.a,null,T.a.t("%{editor} uses OpenStreetMap accounts. Please connect to OSM or create an account in order to be able to contribute.",{editor:window.EDITOR_NAME}))),o.a.createElement(ut.a,null,o.a.createElement(M.a,{onClick:function(){return e._closeDialog(!0)},color:"default"},T.a.t("Cancel")),o.a.createElement(M.a,{onClick:function(){return e._loginClicked()},color:"primary",autoFocus:!0},T.a.t("Login or create account"))))}}]),t}(i.Component),mt=Object(_.g)(ht),ft=n(118),bt=n.n(ft),gt=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={searchText:""},e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("div",{style:{marginTop:30,marginBottom:30}},o.a.createElement(Z.a,null,T.a.t("Busy Hours is a public transport editor for OpenStreetMap. You can easily edit details of public transport lines.")),o.a.createElement(Z.a,null,T.a.t("To start, enter a transport line relation ID in the search field below."))),o.a.createElement(Re.a,{id:"relation-id-field",type:"number",placeholder:"1234567",variant:"outlined",label:T.a.t("Relation ID"),style:{width:"100%"},value:this.state.searchText,onChange:function(t){return e.setState({searchText:t.target.value})},InputProps:{endAdornment:o.a.createElement(xe.a,{position:"end"},o.a.createElement(v.a,{component:p.b,to:"/load/"+this.state.searchText.trim()},o.a.createElement(bt.a,null)))}}))}}]),t}(i.Component),vt=Object(_.g)(gt),yt=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._theme=Object(h.a)({palette:{primary:K.a,secondary:{light:V.a[500],main:V.a[800],dark:V.a[900]}}}),e.state={},e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"_onDataLoaded",value:function(e){this.setState({lines:e}),console.log("Loaded data",e)}},{key:"render",value:function(){var e=this;return o.a.createElement(p.a,null,o.a.createElement(f.b,{utils:W.a},o.a.createElement(m.a,{theme:this._theme},o.a.createElement(de,this.state),o.a.createElement(j.a,{maxWidth:"md",style:{marginTop:20,marginBottom:20}},o.a.createElement(_.d,null,o.a.createElement(_.b,{exact:!0,path:"/",component:vt}),o.a.createElement(_.b,{exact:!0,path:this.state.lines?"/load/:rid":["/load/:rid","/line/:rid","/line/:lid/trip/:rid"],render:function(t){return o.a.createElement(F,Object.assign({},t,e.props,{onDataLoaded:function(t){return e._onDataLoaded(t)}}))}}),this.state.lines&&[o.a.createElement(_.b,{key:0,exact:!0,path:"/line/:lid",render:function(t){return o.a.createElement(lt,Object.assign({},e.state,e.props))}}),o.a.createElement(_.b,{key:1,exact:!0,path:"/line/:lid/trip/:tid",render:function(t){return o.a.createElement(lt,Object.assign({},e.state,e.props))}})])),o.a.createElement(mt,null),o.a.createElement(O,null))))}}]),t}(i.Component),Et=n(83),wt=n.n(Et),Ot=n(120),jt=n(84),kt=n(121),St=n(122),Tt=n.n(St),Ct=n(123),At=n(124),Dt=n.n(At),It=["bus","coach","train","subway","monorail","trolleybus","aerialway","funicular","ferry","tram","share_taxi","light_rail","walking_bus"],Mt=function(){function e(){Object(a.a)(this,e),this._osmApi=new Tt.a({endpoint:P.osm_api_url,oauthConsumerKey:P.oauth_consumer_key,oauthSecret:P.oauth_secret}),this._transportHours=new Dt.a}return Object(r.a)(e,[{key:"_getRelNumber",value:function(e){return e.split("/")[1]}},{key:"_createSimplifiedLineTrip",value:function(e,t,n){e.includes("/")&&(e=e.split("/")[1]);var a=Object.assign({ref:t.ref,name:t.name,colour:t.colour,network:t.network,operator:t.operator,rawTags:t},this._transportHours.tagsToHoursObject(t));return"route"===t.type?(a.type=t.route,a.from=t.from,a.to=t.to):(a.type=t.route_master,a.trips=n),Object(kt.a)({},e,a)}},{key:"loadDataFromRelation",value:function(e){var t=this;return new Promise(function(n,a){t._osmApi.fetchElement(e).then(function(r){var i=t._osmApi.getTags(r),o="route"===i.type?i.route:i.route_master;if(It.includes(o)){if("route"===i.type)t._osmApi.fetchRelationsForElement(e).then(function(r){var o=r.filter(function(e){return"route_master"===t._osmApi.getTags(e).type});if(1===o.length){var s=o[0].member.filter(function(t){return"relation"===t.$.type&&t.$.ref!==e});s.length>0?Promise.all(s.map(function(e){return t._osmApi.fetchElement(e.$.type+"/"+e.$.ref)})).then(function(e){n(t._createSimplifiedLineTrip(o[0].$.id,t._osmApi.getTags(o[0]),Object.assign.apply(Object,[{}].concat(Object(jt.a)(e.map(function(e){return t._createSimplifiedLineTrip(e.$.id,t._osmApi.getTags(e),null)}))))))}).catch(function(e){a("cant_get_trips")}):n(t._createSimplifiedLineTrip(o[0].$.id,t._osmApi.getTags(o[0]),[t._createSimplifiedLineTrip(e,i,null)]))}else 0===o.length?n(t._createSimplifiedLineTrip(e,i,null)):a("many_route_masters")}).catch(function(e){a(e)});else if("route_master"===i.type){var s=r.member.filter(function(e){return"relation"===e.$.type});s.length>0?Promise.all(s.map(function(e){return t._osmApi.fetchElement(e.$.type+"/"+e.$.ref)})).then(function(a){n(t._createSimplifiedLineTrip(e,t._osmApi.getTags(r),Object.assign.apply(Object,[{}].concat(Object(jt.a)(a.map(function(e){return t._createSimplifiedLineTrip(e.$.id,t._osmApi.getTags(e),null)}))))))}).catch(function(e){a("cant_get_trips")}):a("no_trips")}}else a("invalid_mode")}).catch(function(e){a(e)})})}},{key:"saveRelationPeriods",value:function(){var e=Object(Ot.a)(wt.a.mark(function e(t,n){var a,r,i,o;return wt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.editor_user&&window.editor_user_auth){e.next=2;break}return e.abrupt("return",new Error("not_connected"));case 2:this._osmApi._auth=window.editor_user_auth,e.prev=3,a=this._transportHours.intervalsObjectToTags(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(3),e.abrupt("return",e.t0);case 10:return e.prev=10,e.next=13,this._osmApi.fetchElement(t);case 13:if(r=e.sent){e.next=16;break}throw new Error;case 16:e.next=22;break;case 18:return e.prev=18,e.t1=e.catch(10),console.error(e.t1),e.abrupt("return",new Error("cant_find_relation"));case 22:return e.prev=22,e.next=25,this._osmApi.createChangeset(window.EDITOR_NAME+" "+Ct.version,"Changed hours/interval of public transport route "+t,{host:window.EDITOR_URL});case 25:i=e.sent,e.next=32;break;case 28:return e.prev=28,e.t2=e.catch(22),console.error(e.t2),e.abrupt("return",new Error("changeset_failed"));case 32:if(!(a&&i&&r)){e.next=56;break}return r=this._osmApi.setTags(r,a),r=this._osmApi.setTimestampToNow(r),e.prev=35,e.next=38,this._osmApi.sendElement(r,i);case 38:if(o=e.sent,!isNaN(o)){e.next=41;break}throw new Error("Version number invalid",o);case 41:e.next=47;break;case 43:return e.prev=43,e.t3=e.catch(35),console.error(e.t3),e.abrupt("return",new Error("sending_failed"));case 47:return e.prev=47,e.next=50,this._osmApi.closeChangeset(i);case 50:e.next=55;break;case 52:e.prev=52,e.t4=e.catch(47),console.error("Changeset was not closed, will be automatically closed after 30 minutes");case 55:return e.abrupt("return",!0);case 56:case"end":return e.stop()}},e,this,[[3,7],[10,18],[22,28],[35,43],[47,52]])}));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Pt=n(125),Lt=n.n(Pt);window.EDITOR_NAME=P.editor_name;var xt=["en","fr"];window.EDITOR_URL=window.location.origin+window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))+"/",new(function(){function e(){Object(a.a)(this,e),this._initI18n(),this._initCtrl(),this._initView(),this._initAuth()}return Object(r.a)(e,[{key:"_initI18n",value:function(){var e=null;if(window.navigator.languages){var t=!0,a=!1,r=void 0;try{for(var i,o=window.navigator.languages[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;if(xt.includes(s)){e=s;break}}}catch(d){a=!0,r=d}finally{try{t||null==o.return||o.return()}finally{if(a)throw r}}}T.a.locale=e||window.navigator.userLanguage||window.navigator.language,T.a.fallbacks=!0;for(var l=0,c=xt;l<c.length;l++){var u=c[l];Object.assign(T.a.translations,n(207)("./"+u.replace("-","_")+".json"))}}},{key:"_initCtrl",value:function(){this._dataManager=new Mt}},{key:"_initView",value:function(){l.a.render(o.a.createElement(yt,{dataManager:this._dataManager}),document.getElementById("root")),document.title=window.EDITOR_NAME}},{key:"_initAuth",value:function(){var e=this,t={url:P.osm_api_url,oauth_consumer_key:P.oauth_consumer_key,oauth_secret:P.oauth_secret,landing:window.EDITOR_URL+window.location.hash,singlepage:!0};window.editor_user_auth=Lt()(t);var n=this._readURLParams(window.location.href).oauth_token||localStorage.getItem("oauth_token")||null;n?window.editor_user_auth.bootstrapToken(n,function(){e._checkAuth(),window.history.pushState({},"",window.location.href.replace("?oauth_token="+n,"")),localStorage.setItem("oauth_token",n)}):(this._checkAuth(),this.authWait=setInterval(this._checkAuth.bind(this),100)),E.a.subscribe("APP.USER.LOGIN",function(n,a){t.landing=window.EDITOR_URL+window.location.hash,window.editor_user_auth.options(t),window.editor_user_auth.authenticated()||window.editor_user_auth.authenticate(function(t,n){t?(console.error(t),alert(T.a.t("Oops ! Something went wrong when trying to log you in")),E.a.publish("APP.USER.LOGOUT")):e._checkAuth()})}),E.a.subscribe("APP.USER.LOGOUT",function(e,t){window.editor_user_auth&&window.editor_user_auth.authenticated()&&window.editor_user_auth.logout(),window.editor_user=null,localStorage.removeItem("oauth_token")})}},{key:"_checkAuth",value:function(){window.editor_user_auth.authenticated()&&(this.authWait&&clearInterval(this.authWait),window.editor_user_auth.xhr({method:"GET",path:"/api/0.6/user/details"},function(e,t){if(e)console.log(e),window.editor_user_auth.logout();else try{window.editor_user={id:t.firstChild.childNodes[1].attributes.id.value,name:t.firstChild.childNodes[1].attributes.display_name.value,auth:window.editor_user_auth},E.a.publish("APP.USER.READY",{username:window.editor_user.name}),console.log("Logged in as",window.editor_user.name)}catch(n){console.error(n),E.a.publish("APP.USER.LOGOUT")}}))}},{key:"_readURLParams",value:function(e){var t=e.split("?");return t.length>1?t[1].split("#")[0].split("&").filter(function(e){return""!==e}).reduce(function(e,t){var n=t.split("=");return e[decodeURIComponent(n[0])]=null===n[1]?"":decodeURIComponent(n[1]),e},{}):{}}}]),e}())},29:function(e){e.exports={editor_name:"Busy Hours",osm_api_url:"https://www.openstreetmap.org",oauth_consumer_key:"AimasFKiJ0yHaYnEsbLJR36rqYbcSfTV7YE0hXE0",oauth_secret:"8iAQyzFR1MiyO2oXSmCN8XDl7N0VraBWJZUDNvGK"}}},[[150,1,2]]]);
//# sourceMappingURL=main.40e974c7.chunk.js.map