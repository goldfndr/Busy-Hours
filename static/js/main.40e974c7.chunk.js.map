{"version":3,"sources":["config/locales sync /^/.//.*/.json$","view/Alert.js","view/InAlert.js","view/DataLoader.js","view/UserButton.js","view/Header.js","view/DaysPicker.js","view/TimePeriodPicker.js","view/PeriodEditor.js","view/HoursEditor.js","view/ContentLineTrip.js","view/NavLines.js","view/EditorsMenu.js","view/TagsTable.js","view/SummaryLineTrip.js","view/LineTrip.js","view/LoginDialog.js","view/Welcome.js","view/Body.js","ctrl/DataManager.js","index.js"],"names":["map","./en.json","./fr.json","webpackContext","req","id","webpackContextResolve","__webpack_require__","e","Error","code","keys","Object","resolve","module","exports","Alert","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","state","duration","message","type","open","PubSub","subscribe","msg","data","setState","details","_this2","react_default","a","createElement","Snackbar","autoHideDuration","onClose","action","IconButton","key","onClick","color","CloseIcon_default","Component","COLORS","error","red","warning","orange","info","lightBlue","ICONS","AlertCircle","Information","InAlert","level","props","icon","React","style","verticalAlign","relId","relationId","SnackbarContent","backgroundColor","margin","Button","target","href","CONFIG","osm_api_url","I18n","t","ERROR_DETAILS","cant_get_trips","many_route_masters","invalid_mode","no_trips","DataLoader","loading","match","params","rid","textAlign","padding","CircularProgress","size","view_InAlert","isNaN","parseInt","dataManager","loadDataFromRelation","then","onDataLoaded","lineIds","length","page","includes","history","location","pathname","push","catch","console","withRouter","UserButtonComponent","connected","user","menuOpen","menuAnchor","psTokens","publish","_closeMenu","display","Tooltip","title","placement","currentTarget","AccountCircleIcon_default","Menu","anchorEl","bind","MenuItem","disabled","_logoutClick","ListItemIcon","LogoutIcon_default","Typography","variant","AccountIcon_default","_this3","login","username","unsubscribe","Header","AppBar","position","Toolbar","justifyContent","src","height","window","EDITOR_NAME","alt","marginRight","UserButton","DaysPicker","locale","baseDate","Date","UTC","weekDays","i","val","toLocaleDateString","weekday","substring","toLowerCase","lbl","setDate","getDate","evt","clicked","value","newList","selection","slice","filter","v","selected","onChange","days","_getWeekDays","FormControl","component","FormLabel","label","FormGroup","_onChange","row","marginTop","d","FormControlLabel","control","Checkbox","labelPlacement","checked","TimePeriodPicker","fromDate","toDate","interval","newState","fromHour","_hourStringToDateObj","toHour","prevProps","hour","what","_callOnChange","clearTimeout","assign","setTimeout","toTimeString","onInvalid","TimePicker","ampm","initialFocusedDate","width","marginLeft","TextField","placeholder","InputProps","endAdornment","InputAdornment","onDelete","DeleteIcon_default","PeriodEditor","intervals","showEmptyInterval","_notityParent","entries","onValid","log","prevHour","nextHour","nextInterval","newIntervals","_this4","intervalsSorted","sort","b","localeCompare","Grid","container","alignItems","item","xs","sm","view_DaysPicker","_onDaysChanged","AlarmOffIcon_default","itid","_e","slicedToArray","min","view_TimePeriodPicker","split","_editInterval","AlarmPlusIcon_default","period","deepEqual","DEFAULT_PERIOD","HoursEditor","periods","alert","notConnectedAlert","uploading","_busyPeriods","Set","withDefault","Array","isArray","linetrip","allComputedIntervals","p","newP","editor_user","editor_user_auth","_copyPeriods","_getPeriods","add","onEdit","forEach","indexOf","splice","pid","delete","saveRelationPeriods","relid","toString","clear","spacing","marginBottom","_onSend","CloudUploadIcon_default","_onCancel","CancelIcon_default","intv","Paper","view_PeriodEditor","_updatePeriod","_busyPeriod","_deletePeriod","_addPeriod","editedPeriods","psTokenLogin","psTokenLogout","ContentTripLine","tab","line","selectedLine","lines","trip","selectedTrip","trips","Tabs","newval","indicatorColor","textColor","Tab","ref","view_HoursEditor","edits","opening_hours","List","tid","ListItem","ListItemAvatar","data-transport-mode","data-transport-line-code","data-transport-line-color","colour","ListItemText","primary","dest","to","secondary","from","ListItemSecondaryAction","edge","Link","CalendarEditIcon_default","NavLines","stLink","textDecoration","Breadcrumbs","separator","aria-label","react_router_dom","rawTags","route_master","data-transport-destination","Math","toRadians","degrees","PI","toDegrees","radians","EditorsMenu","anchor","url","JOSM_URL","relation","fetch","response","ID_URL","hashtags","replace","encodeURIComponent","join","focus","editor","_onClose","_editId","_editJOSM","editors","name","tip","_click","keepMounted","TagsTable","overflowX","Table","TableHead","TableRow","TableCell","TableBody","tags","SummaryTripLine","showTags","network","operator","defaultInterval","opens","otherIntervals","view_TagsTable","view_EditorsMenu","LineTrip","theProps","lid","react_router","when","view_NavLines","SummaryLineTrip","ContentLineTrip","_checkDataLoaded","LoginDialogComponent","_closeDialog","backToHome","Dialog","DialogTitle","DialogContent","DialogContentText","DialogActions","_loginClicked","autoFocus","Welcome","searchText","trim","MagnifyIcon_default","Body","_theme","createMuiTheme","palette","blue","light","main","dark","newData","MuiPickersUtilsProvider","utils","DateFnsUtils","ThemeProvider","theme","view_Header","Container","maxWidth","exact","path","render","view_DataLoader","_onDataLoaded","view_LineTrip","LoginDialog","view_Alert","VALID_MODES","DataManager","_osmApi","OsmRequest","endpoint","oauthConsumerKey","oauth_consumer_key","oauthSecret","oauth_secret","_transportHours","TransportHours","reltags","result","tagsToHoursObject","route","defineProperty","Promise","reject","fetchElement","relTags","getTags","transportMode","fetchRelationsForElement","parentRelations","routeMasters","r","otherTripsRel","member","m","$","all","tr","otherTripsData","_createSimplifiedLineTrip","apply","concat","toConsumableArray","tripsRel","allPeriods","_auth","newTags","intervalsObjectToTags","osmElement","_context","t1","createChangeset","PACKAGE","version","host","EDITOR_URL","changesetId","t2","setTags","setTimestampToNow","sendElement","t3","closeChangeset","editor_name","LOCALES","origin","lastIndexOf","App","_initI18n","_initCtrl","_initView","_initAuth","navigator","languages","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","l","err","return","userLanguage","language","fallbacks","_i","_LOCALES","translations","require","_dataManager","ReactDOM","view_Body","document","getElementById","opts","landing","hash","singlepage","OsmAuth","token","_readURLParams","oauth_token","localStorage","getItem","bootstrapToken","_checkAuth","pushState","setItem","authWait","setInterval","options","authenticated","authenticate","res","logout","removeItem","clearInterval","xhr","method","firstChild","childNodes","attributes","display_name","auth","str","u","pair","reduce","obj","parts","decodeURIComponent"],"mappings":"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","file":"static/js/main.40e974c7.chunk.js","sourcesContent":["var map = {\n\t\"./en.json\": 208,\n\t\"./fr.json\": 209\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 207;","import React, { Component } from 'react';\nimport Close from 'mdi-react/CloseIcon';\nimport IconButton from '@material-ui/core/IconButton';\nimport PubSub from 'pubsub-js';\nimport Snackbar from '@material-ui/core/Snackbar';\n\n/**\n * Alert component handles non-blocking dialogs display to user.\n * This component listens to {@link Events|UI.MESSAGE.BASIC} events.\n */\nclass Alert extends Component {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.state = {\n\t\t\tduration: 5000,\n\t\t\tmessage: \"\",\n\t\t\ttype: \"info\",\n\t\t\topen: false\n\t\t};\n\n\t\tPubSub.subscribe(\"UI.MESSAGE.BASIC\", (msg, data) => {\n\t\t\tthis.setState({\n\t\t\t\tmessage: data.message+(data.details ? \" (\"+data.details+\")\" : \"\"),\n\t\t\t\tduration: data.duration || (data.details ? 7000 : 5000),\n\t\t\t\ttype: data.type || \"info\",\n\t\t\t\topen: true\n\t\t\t});\n\t\t});\n\t}\n\n\trender() {\n\t\treturn <Snackbar\n\t\t\topen={this.state.open}\n\t\t\tautoHideDuration={this.state.duration}\n\t\t\tonClose={() => this.setState({ open: false })}\n\t\t\tmessage={this.state.message}\n\t\t\taction={[\n\t\t\t\t<IconButton\n\t\t\t\t\tkey=\"close\"\n\t\t\t\t\tonClick={() => this.setState({ open: false })}\n\t\t\t\t\tcolor=\"inherit\"\n\t\t\t\t>\n\t\t\t\t\t<Close />\n\t\t\t\t</IconButton>\n\t\t\t]}\n\t\t/>;\n\t}\n}\n\nexport default Alert;\n\n/**\n * Event for displaying a non-blocking message to user.\n * @event UI.MESSAGE.BASIC\n * @type {Object} Event data\n * @property {string} [type] The kind of message (error, alert, info). Defaults to info.\n * @property {string} message The message text.\n * @property {int} [duration] The message display duration in milliseconds. Defaults to 3000.\n * @memberof App\n */\n","import React, { Component } from 'react';\nimport Alert from 'mdi-react/AlertIcon';\nimport AlertCircle from 'mdi-react/AlertCircleIcon';\nimport Button from '@material-ui/core/Button';\nimport CONFIG from '../config/config.json';\nimport I18n from 'i18nline/lib/i18n';\nimport Information from 'mdi-react/InformationIcon';\nimport SnackbarContent from '@material-ui/core/SnackbarContent';\nimport lightBlue from '@material-ui/core/colors/lightBlue';\nimport orange from '@material-ui/core/colors/orange';\nimport red from '@material-ui/core/colors/red';\n\nconst COLORS = { \"error\": red[600], \"warning\": orange[600], \"info\": lightBlue[600] };\nconst ICONS = { \"error\": AlertCircle, \"warning\": Alert, \"info\": Information };\n\n/**\n * In alert displays a not-so important message to user inline.\n * @property {string} message The text to display\n * @property {string} [level] Importance level (info, warning, error)\n * @property {Component} [icon] An icon to display\n */\nclass InAlert extends Component {\n\trender() {\n\t\tconst level = this.props.level || \"info\";\n\t\tconst icon = this.props.icon || React.createElement(ICONS[level], { style: {verticalAlign: \"middle\"} });\n\t\tconst relId = this.props.relationId || null;\n\n\t\treturn <SnackbarContent\n\t\t\tmessage={\n\t\t\t\t<div>{icon} {this.props.message}</div>\n\t\t\t}\n\t\t\tstyle={{backgroundColor: COLORS[level], color: \"white\", verticalAlign: \"middle\", margin: 10}}\n\t\t\taction={relId ? [\n\t\t\t\t<Button\n\t\t\t\t\tkey=\"osm\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\tcolor=\"inherit\"\n\t\t\t\t\thref={CONFIG.osm_api_url+\"/relation/\"+relId}\n\t\t\t\t>\n\t\t\t\t\t{I18n.t(\"See relation details on OSM\")}\n\t\t\t\t</Button>\n\t\t\t] : null}\n\t\t>\n\t\t</SnackbarContent>;\n\t}\n}\n\nexport default InAlert;\n","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport I18n from 'i18nline/lib/i18n';\nimport InAlert from './InAlert';\n\nconst ERROR_DETAILS = {\n\t\"cant_get_trips\": I18n.t(\"OSM API can't retrieve all trips associated to this line.\"),\n\t\"many_route_masters\": I18n.t(\"This line is not consistent : many route_master relations are associated to this line.\"),\n\t\"invalid_mode\": I18n.t(\"This line is using a transport mode which is not handled (maybe incorrect ?).\"),\n\t\"no_trips\": I18n.t(\"This route master doesn't have any route associated.\")\n};\n\n/**\n * DataLoader is a component for calling DataManager to load wanted relation.\n * It also shows some waiting widget to user.\n */\nclass DataLoader extends Component {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.state = {\n\t\t\tloading: true,\n\t\t\terror: false\n\t\t};\n\t}\n\n\trender() {\n\t\tconst relId = this.props.match.params.rid;\n\t\treturn <div style={{textAlign: \"center\", padding: 30}}>\n\t\t\t{this.state.loading &&\n\t\t\t\t<CircularProgress size={50} />\n\t\t\t}\n\n\t\t\t{this.state.error && ERROR_DETAILS[this.state.error] &&\n\t\t\t\t<InAlert\n\t\t\t\t\tmessage={ERROR_DETAILS[this.state.error]}\n\t\t\t\t\trelationId={relId}\n\t\t\t\t\tlevel=\"error\"\n\t\t\t\t/>\n\t\t\t}\n\n\t\t\t{this.state.error === \"invalid_id\" &&\n\t\t\t\t<InAlert\n\t\t\t\t\tmessage={I18n.t(\"The given relation ID is invalid. Please only give the number in the relation ID (example : 1234).\")}\n\t\t\t\t\tlevel=\"warning\"\n\t\t\t\t/>\n\t\t\t}\n\n\t\t\t{this.state.error === \"api_failed\" &&\n\t\t\t\t<InAlert\n\t\t\t\t\tmessage={I18n.t(\"Oops ! OpenStreetMap API seems unavailable. Please retry a bit later.\")}\n\t\t\t\t\tlevel=\"error\"\n\t\t\t\t/>\n\t\t\t}\n\t\t</div>;\n\t}\n\n\tcomponentDidMount() {\n\t\tconst relId = this.props.match.params.rid;\n\t\tif(!isNaN(parseInt(relId))) {\n\t\t\tthis.setState({ loading: true, error: false });\n\n\t\t\t// Load the relation\n\t\t\tthis.props.dataManager\n\t\t\t.loadDataFromRelation(\"relation/\"+relId)\n\t\t\t.then(data => {\n\t\t\t\tthis.setState({ loading: false, error: false });\n\t\t\t\tthis.props.onDataLoaded(data);\n\n\t\t\t\t// Redirect to proper page\n\t\t\t\tconst lineIds = Object.keys(data);\n\t\t\t\tif(lineIds.length > 0) {\n\t\t\t\t\tconst page = lineIds.includes(relId) ? \"/line/\" + relId : \"/line/\" + lineIds[0] + \"/trip/\" + relId;\n\n\t\t\t\t\tif(this.props.history.location.pathname !== page) {\n\t\t\t\t\t\tthis.props.history.push(page);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tthis.setState({ loading: false, error: ERROR_DETAILS[error] ? error : \"api_failed\" });\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tthis.setState({ loading: false, error: \"invalid_id\" });\n\t\t}\n\t}\n}\n\nexport default withRouter(DataLoader);\n","import React, { Component } from 'react';\nimport Account from 'mdi-react/AccountIcon';\nimport AccountCircle from 'mdi-react/AccountCircleIcon';\nimport Logout from 'mdi-react/LogoutIcon';\nimport Button from '@material-ui/core/Button';\nimport I18n from 'i18nline/lib/i18n';\nimport IconButton from '@material-ui/core/IconButton';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport PubSub from 'pubsub-js';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Typography from '@material-ui/core/Typography';\n\n/**\n * User button component handles switching between multiple states of user connection.\n */\nclass UserButtonComponent extends Component {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.state = {\n\t\t\tconnected: false,\n\t\t\tuser: null,\n\t\t\tmenuOpen: false,\n\t\t\tmenuAnchor: null\n\t\t};\n\n\t\tthis.psTokens = {};\n\t}\n\n\t/**\n\t * Closes the menu.\n\t * @private\n\t */\n\t_closeMenu() {\n\t\tthis.setState({ menuOpen: false, menuAnchor: null });\n\t}\n\n\t/**\n\t * Handler for logout click.\n\t * @private\n\t */\n\t_logoutClick() {\n\t\tPubSub.publish(\"APP.USER.LOGOUT\");\n\t\tthis._closeMenu();\n\t\tthis.setState({ connected: false, user: null });\n\t}\n\n\trender() {\n\t\tif(this.state.connected) {\n\t\t\treturn <div style={{display: \"inline\"}}>\n\t\t\t\t<Tooltip title={I18n.t(\"Account\")} placement=\"bottom\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tcolor=\"inherit\"\n\t\t\t\t\t\tonClick={e => this.setState({ menuOpen: true, menuAnchor: e.currentTarget })}\n\t\t\t\t\t>\n\t\t\t\t\t\t<AccountCircle />\n\t\t\t\t\t</IconButton>\n\t\t\t\t</Tooltip>\n\t\t\t\t<Menu\n\t\t\t\t\tanchorEl={this.state.menuAnchor}\n\t\t\t\t\topen={this.state.menuOpen}\n\t\t\t\t\tonClose={this._closeMenu.bind(this)}\n\t\t\t\t>\n\t\t\t\t\t<MenuItem disabled>{this.state.user}</MenuItem>\n\t\t\t\t\t<MenuItem onClick={this._logoutClick.bind(this)}>\n\t\t\t\t\t\t<ListItemIcon>\n\t\t\t\t\t\t\t<Logout />\n\t\t\t\t\t\t</ListItemIcon>\n\t\t\t\t\t\t<Typography variant=\"inherit\">{I18n.t(\"Log Out\")}</Typography>\n\t\t\t\t\t</MenuItem>\n\t\t\t\t</Menu>\n\t\t\t</div>;\n\t\t}\n\t\telse {\n\t\t\treturn <Tooltip title={I18n.t(\"Log In\")} placement=\"bottom\">\n\t\t\t\t<Button\n\t\t\t\t\tcolor=\"inherit\"\n\t\t\t\t\tonClick={() => PubSub.publish(\"APP.USER.WANTSLOGIN\")}\n\t\t\t\t>\n\t\t\t\t\t<Account />\n\t\t\t\t\t{I18n.t(\"Log In\")}\n\t\t\t\t</Button>\n\t\t\t</Tooltip>;\n\t\t}\n\t}\n\n\tcomponentWillMount() {\n\t\tthis.psTokens.login = PubSub.subscribe(\"APP.USER.READY\", (msg, data) => {\n\t\t\tthis.setState({ user: data.username, connected: true });\n\t\t});\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif(this.psTokens.login) {\n\t\t\tPubSub.unsubscribe(this.psTokens.login);\n\t\t}\n\t}\n}\n\nexport default UserButtonComponent;\n","import React, { Component } from 'react';\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport UserButton from './UserButton';\n\n/**\n * Header component is the navigation toolbar on top of page.\n */\nclass Header extends Component {\n\trender() {\n\t\treturn <AppBar position=\"static\" style={{backgroundColor: \"#0267b1\"}}>\n\t\t\t<Toolbar style={{justifyContent: \"space-between\"}}>\n\t\t\t\t<div>\n\t\t\t\t\t<img\n\t\t\t\t\t\tsrc=\"header.png\"\n\t\t\t\t\t\theight={64}\n\t\t\t\t\t\ttitle={window.EDITOR_NAME}\n\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\tstyle={{verticalAlign: \"middle\", marginRight: 10}}\n\t\t\t\t\t/>\n\t\t\t\t\t<Typography variant=\"h6\" style={{display: \"inline-block\"}}>\n\t\t\t\t\t\t{window.EDITOR_NAME}\n\t\t\t\t\t</Typography>\n\t\t\t\t</div>\n\n\t\t\t\t<UserButton />\n\t\t\t</Toolbar>\n\t\t</AppBar>;\n\t}\n}\n\nexport default Header;\n","import React, { Component } from 'react';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport FormGroup from '@material-ui/core/FormGroup';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormLabel from '@material-ui/core/FormLabel';\nimport I18n from 'i18nline/lib/i18n';\n\n/**\n * DaysPicker allows to select days in a week.\n * Shown days are localized thanks to `toLocaleDateString` browser method.\n *\n * @property {string} label Label for the field\n * @property {string[]} selection Values to show as selected\n * @property {function} [onChange] Handler for value changes\n */\nclass DaysPicker extends Component {\n\t_getWeekDays(locale) {\n\t\tlet baseDate = new Date(Date.UTC(2017, 0, 2)); // just a Monday\n\t\tconst weekDays = [];\n\n\t\tfor(let i = 0; i < 7; i++) {\n\t\t\tweekDays.push({\n\t\t\t\tval: baseDate.toLocaleDateString(\"en-GB\", { weekday: \"long\" }).substring(0, 2).toLowerCase(),\n\t\t\t\tlbl: baseDate.toLocaleDateString(locale, { weekday: \"short\" })\n\t\t\t});\n\t\t\tbaseDate.setDate(baseDate.getDate() + 1);\n\t\t}\n\n\t\tweekDays.push({ val: \"ph\", lbl: I18n.t(\"PH\") });\n\n\t\treturn weekDays;\n\t}\n\n\t_onChange(evt) {\n\t\tconst clicked = evt.target.value;\n\t\tlet newList = this.props.selection.slice(0);\n\n\t\tif(!this.props.selection.includes(clicked)) {\n\t\t\tnewList.push(clicked);\n\t\t}\n\t\telse {\n\t\t\tnewList = newList.filter(v => v !== clicked);\n\t\t}\n\n\t\tthis.setState({ selected: newList });\n\n\t\tif(this.props.onChange) {\n\t\t\tthis.props.onChange(newList);\n\t\t}\n\t}\n\n\trender() {\n\t\tconst days = this._getWeekDays(I18n.locale);\n\n\t\treturn <FormControl component=\"fieldset\">\n\t\t\t<FormLabel component=\"legend\">{this.props.label}</FormLabel>\n\t\t\t<FormGroup\n\t\t\t\tvalue={this.props.value}\n\t\t\t\tonChange={e => this._onChange(e)}\n\t\t\t\trow\n\t\t\t\tstyle={{marginTop: 5}}\n\t\t\t>\n\t\t\t\t{days.map(d => (\n\t\t\t\t\t<FormControlLabel\n\t\t\t\t\t\tkey={d.val}\n\t\t\t\t\t\tvalue={d.val}\n\t\t\t\t\t\tcontrol={<Checkbox color=\"primary\" />}\n\t\t\t\t\t\tlabel={d.lbl}\n\t\t\t\t\t\tlabelPlacement=\"top\"\n\t\t\t\t\t\tstyle={{margin: 0}}\n\t\t\t\t\t\tchecked={this.props.selection.includes(d.val)}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t</FormGroup>\n\t\t</FormControl>;\n\t}\n}\n\nexport default DaysPicker;\n","import React, { Component } from 'react';\nimport IconButton from '@material-ui/core/IconButton';\nimport Delete from 'mdi-react/DeleteIcon';\nimport FormGroup from '@material-ui/core/FormGroup';\nimport FormControl from '@material-ui/core/FormControl';\nimport I18n from 'i18nline/lib/i18n';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport TextField from '@material-ui/core/TextField';\nimport { TimePicker } from \"@material-ui/pickers\";\n\n/**\n * TimePeriodPicker allows to select an hour range.\n */\nclass TimePeriodPicker extends Component {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.state = {\n\t\t\tfromDate: null,\n\t\t\ttoDate: null,\n\t\t\tinterval: \"\"\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tconst newState = {};\n\n\t\tif(this.props.fromHour) {\n\t\t\tnewState.fromDate = this._hourStringToDateObj(this.props.fromHour);\n\t\t}\n\n\t\tif(this.props.toHour) {\n\t\t\tnewState.toDate = this._hourStringToDateObj(this.props.toHour);\n\t\t}\n\n\t\tif(this.props.interval) {\n\t\t\tnewState.interval = this.props.interval;\n\t\t}\n\n\t\tthis.setState(newState);\n\t}\n\n\tcomponentDidUpdate(prevProps) {\n\t\tconst newState = {};\n\n\t\tif(prevProps.fromHour !== this.props.fromHour) {\n\t\t\tnewState.fromDate = this._hourStringToDateObj(this.props.fromHour);\n\t\t}\n\n\t\tif(prevProps.toHour !== this.props.toHour) {\n\t\t\tnewState.toDate = this._hourStringToDateObj(this.props.toHour);\n\t\t}\n\n\t\tif(prevProps.interval !== this.props.interval) {\n\t\t\tnewState.interval = this.props.interval;\n\t\t}\n\n\t\tif(Object.keys(newState).length > 0) {\n\t\t\tthis.setState(newState);\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_hourStringToDateObj(hour) {\n\t\treturn hour ? new Date(\"1970-01-01T\"+hour+\":00\") : null;\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_onChange(what, value) {\n\t\tif(this._callOnChange) {\n\t\t\tclearTimeout(this._callOnChange);\n\t\t\tdelete this._callOnChange;\n\t\t}\n\n\t\tconst newState = Object.assign({}, this.state);\n\t\tnewState[what] = value;\n\n\t\tif(newState.fromDate instanceof Date && newState.toDate instanceof Date && !isNaN(parseInt(newState.interval))) {\n\t\t\tthis._callOnChange = setTimeout(() => {\n\t\t\t\tconst fromHour = newState.fromDate.toTimeString().substring(0,5);\n\t\t\t\tconst toHour = newState.toDate.toTimeString().substring(0,5);\n\t\t\t\tthis.props.onChange(fromHour + \"-\" + toHour, parseInt(newState.interval));\n\t\t\t}, 1000);\n\t\t}\n\t\telse {\n\t\t\tthis.props.onInvalid();\n\t\t}\n\n\t\tthis.setState(newState);\n\t}\n\n\trender() {\n\t\treturn <FormControl component=\"fieldset\" style={{display: \"block\"}}>\n\t\t\t<FormGroup\n\t\t\t\tvalue={this.props.value}\n\t\t\t\trow\n\t\t\t\tstyle={{marginTop: 5, display: \"flex\", justifyContent: \"space-between\"}}\n\t\t\t>\n\t\t\t\t<TimePicker\n\t\t\t\t\tampm={false}\n\t\t\t\t\tinitialFocusedDate={new Date(\"1970-01-01T00:00:00\")}\n\t\t\t\t\tvalue={this.state.fromDate}\n\t\t\t\t\tlabel={I18n.t(\"From\")}\n\t\t\t\t\tstyle={{width: 80}}\n\t\t\t\t\tonChange={d => this._onChange(\"fromDate\", d)}\n\t\t\t\t/>\n\n\t\t\t\t<TimePicker\n\t\t\t\t\tampm={false}\n\t\t\t\t\tinitialFocusedDate={new Date(\"1970-01-01T00:00:00\")}\n\t\t\t\t\tvalue={this.state.toDate}\n\t\t\t\t\tlabel={I18n.t(\"To\")}\n\t\t\t\t\tstyle={{marginRight: 20, marginLeft: 20, width: 80}}\n\t\t\t\t\tonChange={d => this._onChange(\"toDate\", d)}\n\t\t\t\t/>\n\n\t\t\t\t<TextField\n\t\t\t\t\tlabel={I18n.t(\"Interval\")}\n\t\t\t\t\tvalue={this.state.interval}\n\t\t\t\t\tplaceholder=\"42\"\n\t\t\t\t\ttype=\"number\"\n\t\t\t\t\tInputProps={{\n\t\t\t\t\t\tendAdornment: <InputAdornment position=\"end\">min</InputAdornment>,\n\t\t\t\t\t}}\n\t\t\t\t\tstyle={{width: 150}}\n\t\t\t\t\tonChange={evt => this._onChange(\"interval\", evt.target.value)}\n\t\t\t\t/>\n\n\t\t\t\t<IconButton\n\t\t\t\t\ttitle={I18n.t(\"Delete this interval\")}\n\t\t\t\t\tsize=\"small\"\n\t\t\t\t\tstyle={{marginLeft: 10}}\n\t\t\t\t\tonClick={() => this.props.onDelete()}\n\t\t\t\t>\n\t\t\t\t\t<Delete />\n\t\t\t\t</IconButton>\n\t\t\t</FormGroup>\n\t\t</FormControl>;\n\t}\n}\n\nexport default TimePeriodPicker;\n","import React, { Component } from 'react';\nimport AlarmOff from 'mdi-react/AlarmOffIcon';\nimport AlarmPlus from 'mdi-react/AlarmPlusIcon';\nimport Button from '@material-ui/core/Button';\nimport DaysPicker from './DaysPicker';\nimport deepEqual from 'fast-deep-equal';\nimport Grid from '@material-ui/core/Grid';\nimport I18n from 'i18nline/lib/i18n';\nimport TimePeriodPicker from './TimePeriodPicker';\n\n/**\n * Period editor allows to edit days and intervals of a single period.\n */\nclass PeriodEditor extends Component {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.state = {\n\t\t\tdays: [],\n\t\t\tintervals: null,\n\t\t\tshowEmptyInterval: false\n\t\t};\n\t}\n\n\t_onDaysChanged(days) {\n\t\tthis.setState({ days: days }, () => this._notityParent());\n\t}\n\n\t_notityParent() {\n\t\tif(\n\t\t\t!this.state.showEmptyInterval\n\t\t\t&& this.state.days.length > 0\n\t\t\t&& this.state.intervals\n\t\t\t&& Object.keys(this.state.intervals).length > 0\n\t\t\t&& Object.entries(this.state.intervals).filter(e => !e[0].match(/^\\d{2}:\\d{2}-\\d{2}:\\d{2}$/) || isNaN(e[1])).length === 0\n\t\t) {\n\t\t\tthis.props.onValid({ days: this.state.days, intervals: this.state.intervals });\n\t\t}\n\t\telse {\n\t\t\tconsole.log(\"invalid\", this.state);\n\t\t\tthis.props.onInvalid();\n\t\t}\n\t}\n\n\t_editInterval(prevHour, nextHour, nextInterval) {\n\t\tconst newIntervals = this.state.intervals === null ? {} : Object.assign({}, this.state.intervals);\n\n\t\tif(prevHour) {\n\t\t\tdelete newIntervals[prevHour];\n\t\t}\n\n\t\tif(nextHour) {\n\t\t\tnewIntervals[nextHour] = nextInterval || null;\n\t\t}\n\n\t\tthis.setState({ intervals: Object.keys(newIntervals).length > 0 ? newIntervals : null }, () => this._notityParent());\n\t}\n\n\trender() {\n\t\tconst intervalsSorted = this.state.intervals ? Object.entries(this.state.intervals).sort((a,b) => a[0].localeCompare(b[0])) : [];\n\n\t\treturn <Grid container alignItems=\"center\">\n\t\t\t<Grid item xs={12} sm={6}>\n\t\t\t\t<DaysPicker\n\t\t\t\t\tlabel={I18n.t(\"Days concerned\")}\n\t\t\t\t\tselection={this.state.days}\n\t\t\t\t\tonChange={days => this._onDaysChanged(days)}\n\t\t\t\t/>\n\n\t\t\t\t<Button\n\t\t\t\t\tstyle={{marginTop: 10}}\n\t\t\t\t\tonClick={() => this.props.onDelete()}\n\t\t\t\t>\n\t\t\t\t\t<AlarmOff /> {I18n.t(\"Delete this period\")}\n\t\t\t\t</Button>\n\t\t\t</Grid>\n\t\t\t<Grid item xs={12} sm={6}>\n\t\t\t\t{intervalsSorted.map((e,itid) => {\n\t\t\t\t\tconst [ hour, min ] = e;\n\t\t\t\t\treturn <TimePeriodPicker\n\t\t\t\t\t\tfromHour={hour.split(\"-\")[0]}\n\t\t\t\t\t\ttoHour={hour.split(\"-\")[1]}\n\t\t\t\t\t\tinterval={min}\n\t\t\t\t\t\tkey={itid}\n\t\t\t\t\t\tonChange={(nextHour, nextInterval) => this._editInterval(hour, nextHour, nextInterval)}\n\t\t\t\t\t\tonDelete={() => this._editInterval(hour)}\n\t\t\t\t\t\tonInvalid={() => this.props.onInvalid()}\n\t\t\t\t\t/>;\n\t\t\t\t})}\n\n\t\t\t\t{this.state.showEmptyInterval &&\n\t\t\t\t\t<TimePeriodPicker\n\t\t\t\t\t\tfromHour={intervalsSorted.length > 0 ? intervalsSorted[intervalsSorted.length-1][0].split(\"-\")[1] : null}\n\t\t\t\t\t\tonChange={(nextHour, nextInterval) => {\n\t\t\t\t\t\t\tthis.setState({ showEmptyInterval: false }, () => {\n\t\t\t\t\t\t\t\tthis._editInterval(null, nextHour, nextInterval);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tonDelete={() => this.setState({ showEmptyInterval: false })}\n\t\t\t\t\t\tonInvalid={() => this.props.onInvalid()}\n\t\t\t\t\t/>\n\t\t\t\t}\n\n\t\t\t\t<Button\n\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\tstyle={{marginTop: 10}}\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tthis.props.onInvalid();\n\t\t\t\t\t\tthis.setState({ showEmptyInterval: true });\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<AlarmPlus /> {I18n.t(\"Add a new interval\")}\n\t\t\t\t</Button>\n\t\t\t</Grid>\n\t\t</Grid>;\n\t}\n\n\tcomponentDidMount() {\n\t\tif(this.props.period) {\n\t\t\tthis.setState(this.props.period);\n\t\t}\n\t}\n\n\tcomponentDidUpdate(prevProps) {\n\t\tif(this.props.period) {\n\t\t\tif(!prevProps.period || !prevProps.period.days || !deepEqual(prevProps.period.days, this.props.period.days)) {\n\t\t\t\tthis.setState({ days: this.props.period.days });\n\t\t\t}\n\n\t\t\tif(!prevProps.period || !prevProps.period.intervals || !deepEqual(prevProps.period.intervals, this.props.period.intervals)) {\n\t\t\t\tthis.setState({ intervals: this.props.period.intervals });\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.setState({ days: [], intervals: {} });\n\t\t}\n\t}\n}\n\nexport default PeriodEditor;\n","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport AlarmPlus from 'mdi-react/AlarmPlusIcon';\nimport Button from '@material-ui/core/Button';\nimport Cancel from 'mdi-react/CancelIcon';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport CloudUpload from 'mdi-react/CloudUploadIcon';\nimport deepEqual from 'fast-deep-equal';\nimport Grid from '@material-ui/core/Grid';\nimport I18n from 'i18nline/lib/i18n';\nimport InAlert from './InAlert';\nimport Paper from '@material-ui/core/Paper';\nimport PeriodEditor from './PeriodEditor';\nimport PubSub from 'pubsub-js';\n\nconst DEFAULT_PERIOD = { days: [\"mo\",\"tu\",\"we\",\"th\",\"fr\"], intervals: {} };\n\n/**\n * HoursEditor component display opening hours and frequencies of current transport line/trip.\n */\nclass HoursEditor extends Component {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.state = {\n\t\t\tperiods: null,\n\t\t\talert: null,\n\t\t\tnotConnectedAlert: false,\n\t\t\tuploading: false\n\t\t};\n\n\t\tthis._busyPeriods = new Set();\n\t}\n\n\t/**\n\t * Choose correct periods set from properties, state or default\n\t * @private\n\t */\n\t_getPeriods(withDefault) {\n\t\treturn this.state.periods || (Array.isArray(this.props.linetrip.allComputedIntervals) && this.props.linetrip.allComputedIntervals) || (withDefault ? [ DEFAULT_PERIOD ] : []);\n\t}\n\n\t/**\n\t * Create a shallow copy of given periods object for editing\n\t * @private\n\t */\n\t_copyPeriods(periods) {\n\t\treturn periods.slice(0).map(p => {\n\t\t\tconst newP = Object.assign({}, p);\n\t\t\tnewP.days = p.days.slice(0);\n\t\t\tnewP.intervals = Object.assign({}, p.intervals);\n\t\t\treturn newP;\n\t\t});\n\t}\n\n\t/**\n\t * Create a new period\n\t * @private\n\t */\n\t_addPeriod() {\n\t\tif(!window.editor_user || !window.editor_user_auth) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst periods = this._copyPeriods(this._getPeriods());\n\n\t\tif(periods.length === 0) {\n\t\t\tthis._busyPeriods.add(0);\n\t\t\tthis.props.onEdit([ DEFAULT_PERIOD ]);\n\t\t}\n\t\telse {\n\t\t\t// Find first unused day\n\t\t\tconst days = [ \"mo\", \"tu\", \"we\", \"th\", \"fr\", \"sa\", \"su\", \"ph\" ];\n\t\t\tperiods.forEach(p => {\n\t\t\t\tp.days.forEach(d => {\n\t\t\t\t\tconst id = days.indexOf(d);\n\t\t\t\t\tif(id >= 0) {\n\t\t\t\t\t\tdays.splice(id, 1);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Create new period\n\t\t\tperiods.push({\n\t\t\t\tdays: days.length > 0 ? [ days[0] ] : [],\n\t\t\t\tintervals: {}\n\t\t\t});\n\n\t\t\tthis._busyPeriods.add(periods.length-1);\n\t\t\tthis.props.onEdit(periods);\n\t\t}\n\t}\n\n\t/**\n\t * Changes a period definition\n\t * @private\n\t */\n\t_updatePeriod(pid, period) {\n\t\tif(!window.editor_user || !window.editor_user_auth) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst periods = this._copyPeriods(this._getPeriods());\n\n\t\tif(periods[pid]) {\n\t\t\tperiods[pid] = period;\n\t\t\tthis._busyPeriods.delete(pid);\n\t\t\tthis.props.onEdit(periods);\n\t\t}\n\t}\n\n\t_busyPeriod(pid) {\n\t\tthis._busyPeriods.add(pid);\n\t}\n\n\t/**\n\t * Delete a given period\n\t * @private\n\t */\n\t_deletePeriod(pid) {\n\t\tif(!window.editor_user || !window.editor_user_auth) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst periods = this._copyPeriods(this._getPeriods());\n\n\t\tif(periods[pid]) {\n\t\t\tperiods.splice(pid, 1);\n\t\t\tthis._busyPeriods.delete(pid);\n\t\t\tthis.props.onEdit(periods);\n\t\t}\n\t}\n\n\t/**\n\t * Event handler after click on send button\n\t * @private\n\t */\n\t_onSend() {\n\t\tif(this._busyPeriods.size > 0) {\n\t\t\tPubSub.publish(\"UI.MESSAGE.BASIC\", { message: I18n.t(\"Some periods are incomplete, please check your data before uploading\") });\n\t\t}\n\t\telse if(this.state.periods.length === 0) {\n\t\t\tPubSub.publish(\"UI.MESSAGE.BASIC\", { message: I18n.t(\"No period has been added, please add information about this line opening hours\") });\n\t\t}\n\t\telse if(this.state.periods && this.props.dataManager) {\n\t\t\tthis.setState({ uploading: true });\n\n\t\t\tthis.props.dataManager\n\t\t\t.saveRelationPeriods(\"relation/\"+this.props.relid, this.state.periods)\n\t\t\t.then(() => {\n\t\t\t\t// Clear tmp data\n\t\t\t\tthis.props.onEdit(null);\n\t\t\t\tthis.setState({ periods: null, uploading: false }, () => {\n\t\t\t\t\t// Show success message\n\t\t\t\t\talert(I18n.t(\"Your edits were successfully sent to OSM\"));\n\n\t\t\t\t\t// Redirect to data loader\n\t\t\t\t\tthis.props.history.push(\"/load/\"+this.props.relid);\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\t// Show failure message\n\t\t\t\tlet message = e.message ? e.message : e.toString();\n\t\t\t\tif(message === \"not_connected\") { message = I18n.t(\"You have to be connected before sending your edits\"); }\n\t\t\t\telse if(message === \"changeset_failed\") { message = I18n.t(\"OSM server is not able to create a changeset for now\"); }\n\t\t\t\telse if(message === \"cant_find_relation\") { message = I18n.t(\"This public transport route is not available on OSM server\"); }\n\t\t\t\telse if(message === \"sending_failed\") { message = I18n.t(\"An error happened when sending your changes to OSM server\"); }\n\n\t\t\t\tthis.setState({ uploading: false, alert: { message: message } }, () => {\n\t\t\t\t\tsetTimeout(() => this.setState({ alert: null }), 5000);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Event handler after cancel button click\n\t * @private\n\t */\n\t_onCancel() {\n\t\tthis.setState({ periods: null });\n\t\tthis._busyPeriods.clear();\n\t\tthis.props.onEdit(null);\n\t}\n\n\trender() {\n\t\tif(this.state.uploading) {\n\t\t\treturn <div style={{marginTop: 10, textAlign: \"center\"}}>\n\t\t\t\t<CircularProgress style={{verticalAlign: \"middle\", marginRight: 10}} /> {I18n.t(\"Uploading your edits\")}\n\t\t\t</div>;\n\t\t}\n\t\telse {\n\t\t\tconst periods = this._getPeriods();\n\n\t\t\treturn <div style={{marginTop: 10}}>\n\t\t\t\t{this.state.alert &&\n\t\t\t\t\t<InAlert\n\t\t\t\t\t\tlevel={this.state.alert.level || \"warning\"}\n\t\t\t\t\t\tmessage={this.state.alert.message}\n\t\t\t\t\t/>\n\t\t\t\t}\n\n\t\t\t\t{window.editor_user && window.editor_user_auth && this.state.periods &&\n\t\t\t\t\t<Grid container alignItems=\"center\" spacing={2} style={{marginBottom: 10}}>\n\t\t\t\t\t\t<Grid item xs={12} sm={6}>\n\t\t\t\t\t\t\t{I18n.t(\"You have edited this line hours.\")}\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t<Grid item xs={6} sm={3}>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"contained\"\n\t\t\t\t\t\t\t\tcolor=\"primary\"\n\t\t\t\t\t\t\t\tstyle={{width: \"100%\"}}\n\t\t\t\t\t\t\t\tonClick={() => this._onSend()}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<CloudUpload /> {I18n.t(\"Send to OSM\")}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t<Grid item xs={6} sm={3}>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"contained\"\n\t\t\t\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\t\t\t\tstyle={{width: \"100%\"}}\n\t\t\t\t\t\t\t\tonClick={() => this._onCancel()}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Cancel /> {I18n.t(\"Cancel all\")}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t</Grid>\n\t\t\t\t}\n\n\t\t\t\t{periods && periods.map((intv, pid) => (\n\t\t\t\t\t<Paper style={{padding: 10, marginBottom: 20}} key={pid}>\n\t\t\t\t\t\t<PeriodEditor\n\t\t\t\t\t\t\tperiod={intv}\n\t\t\t\t\t\t\tonValid={p => this._updatePeriod(pid, p)}\n\t\t\t\t\t\t\tonInvalid={() => this._busyPeriod(pid)}\n\t\t\t\t\t\t\tonDelete={() => this._deletePeriod(pid)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Paper>\n\t\t\t\t))}\n\n\t\t\t\t<Button\n\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\tstyle={{marginTop: 10}}\n\t\t\t\t\tonClick={() => this._addPeriod()}\n\t\t\t\t>\n\t\t\t\t\t<AlarmPlus /> {I18n.t(\"Add a new period\")}\n\t\t\t\t</Button>\n\n\t\t\t</div>;\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tif(this.props.editedPeriods) {\n\t\t\tthis.setState({ periods: this.props.editedPeriods });\n\t\t}\n\n\t\tif(!window.editor_user || !window.editor_user_auth) {\n\t\t\tthis.setState({ alert: { level: \"info\", message: I18n.t(\"You have to be connected to edit line hours\") }, notConnectedAlert: true });\n\t\t}\n\n\t\tthis.psTokenLogin = PubSub.subscribe(\"APP.USER.READY\", (msg, data) => {\n\t\t\tif(data && this.state.notConnectedAlert) {\n\t\t\t\tthis.setState({ alert: null, notConnectedAlert: false });\n\t\t\t}\n\t\t});\n\n\t\tthis.psTokenLogout = PubSub.subscribe(\"APP.USER.LOGOUT\", (msg, data) => {\n\t\t\tif(!this.state.notConnectedAlert) {\n\t\t\t\tthis.setState({ alert: { level: \"info\", message: I18n.t(\"You have to be connected to edit line hours\") }, notConnectedAlert: true });\n\t\t\t}\n\t\t});\n\t}\n\n\tcomponentDidUpdate(prevProps) {\n\t\tif(!deepEqual(this.props.editedPeriods, this.state.periods)) {\n\t\t\tthis.setState({ periods: this.props.editedPeriods });\n\t\t}\n\n\t\tif(!this.state.notConnectedAlert && (!window.editor_user || !window.editor_user_auth)) {\n\t\t\tthis.setState({ alert: { level: \"info\", message: I18n.t(\"You have to be connected to edit line hours\") }, notConnectedAlert: true });\n\t\t}\n\n\t\tif(this.state.notConnectedAlert && window.editor_user && window.editor_user_auth) {\n\t\t\tthis.setState({ alert: null, notConnectedAlert: false });\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif(this.psTokenLogin) {\n\t\t\tPubSub.unsubscribe(\"APP.USER.READY\", this.psTokenLogin);\n\t\t}\n\t\tif(this.psTokenLogout) {\n\t\t\tPubSub.unsubscribe(\"APP.USER.LOGOUT\", this.psTokenLogout);\n\t\t}\n\t}\n}\n\nexport default withRouter(HoursEditor);\n","import React, { Component } from 'react';\nimport Button from '@material-ui/core/Button';\nimport CalendarEdit from 'mdi-react/CalendarEditIcon';\nimport I18n from 'i18nline/lib/i18n';\nimport InAlert from './InAlert';\nimport HoursEditor from './HoursEditor';\nimport { Link } from 'react-router-dom';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport ListItemAvatar from '@material-ui/core/ListItemAvatar';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\n\n/**\n * ContentTripLine is a component for both seeing trips of a line, and viewing/editing line hours.\n */\nclass ContentTripLine extends Component {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.state = {\n\t\t\ttab: 0\n\t\t};\n\t}\n\n\trender() {\n\t\tconst line = this.props.selectedLine && this.props.lines && this.props.lines[this.props.selectedLine] ? this.props.lines[this.props.selectedLine] : null;\n\t\tconst trip = line && this.props.selectedTrip && line.trips[this.props.selectedTrip] ? line.trips[this.props.selectedTrip] : null;\n\n\t\treturn <div>\n\t\t\t<Tabs\n\t\t\t\tvalue={trip ? 0 : this.state.tab}\n\t\t\t\tonChange={(e, newval) => this.setState({ tab: newval })}\n\t\t\t\tindicatorColor=\"primary\"\n\t\t\t\ttextColor=\"primary\"\n\t\t\t>\n\t\t\t\t<Tab label={I18n.t(\"Hours\")} />\n\t\t\t\t{!trip && line.trips && <Tab label={I18n.t(\"Trips\")} />}\n\t\t\t</Tabs>\n\n\t\t\t{((!trip && this.state.tab === 0) || trip) && <div>\n\t\t\t\t{trip &&\n\t\t\t\t\t<InAlert\n\t\t\t\t\t\tmessage={I18n.t(\"This trip belongs to line %{line}. If all trips of this line have similar hours, please edit line information instead of trips ones.\", { line: line.ref })}\n\t\t\t\t\t/>\n\t\t\t\t}\n\n\t\t\t\t<HoursEditor\n\t\t\t\t\tlinetrip={trip || line}\n\t\t\t\t\trelid={trip ? this.props.selectedTrip : this.props.selectedLine}\n\t\t\t\t\tdataManager={this.props.dataManager}\n\t\t\t\t\teditedPeriods={this.props.edits}\n\t\t\t\t\tonEdit={periods => this.props.onEdit(periods)}\n\t\t\t\t/>\n\t\t\t</div>}\n\n\t\t\t{!trip && this.state.tab === 1 && <div>\n\t\t\t\t{(line.opening_hours || line.interval) &&\n\t\t\t\t\t<InAlert\n\t\t\t\t\t\tmessage={I18n.t(\"This line already has hours defined. You may not need to add hours on trips if they are similar.\")}\n\t\t\t\t\t/>\n\t\t\t\t}\n\n\t\t\t\t<List>\n\t\t\t\t\t{Object.entries(line.trips).map(e => {\n\t\t\t\t\t\tconst [ tid, t ] = e;\n\t\t\t\t\t\treturn <ListItem key={tid}>\n\t\t\t\t\t\t\t<ListItemAvatar>\n\t\t\t\t\t\t\t\t<transport-thumbnail\n\t\t\t\t\t\t\t\t\tdata-transport-mode={line.type}\n\t\t\t\t\t\t\t\t\tdata-transport-line-code={t.ref || line.ref}\n\t\t\t\t\t\t\t\t\tdata-transport-line-color={t.colour || line.colour}>\n\t\t\t\t\t\t\t\t</transport-thumbnail>\n\t\t\t\t\t\t\t</ListItemAvatar>\n\t\t\t\t\t\t\t<ListItemText\n\t\t\t\t\t\t\t\tprimary={I18n.t(\"Destination : %{dest}\", { dest: t.to })}\n\t\t\t\t\t\t\t\tsecondary={I18n.t(\"From : %{from}\", { from: t.from })}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<ListItemSecondaryAction>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tedge=\"end\"\n\t\t\t\t\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\t\t\t\t\tcomponent={Link}\n\t\t\t\t\t\t\t\t\tto={\"/line/\"+this.props.selectedLine+\"/trip/\"+tid}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<CalendarEdit /> {I18n.t(\"Edit hours\")}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</ListItemSecondaryAction>\n\t\t\t\t\t\t</ListItem>;\n\t\t\t\t\t})}\n\t\t\t\t</List>\n\t\t\t</div>}\n\t\t</div>;\n\t}\n}\n\nexport default ContentTripLine;\n","import React, { Component } from 'react';\nimport Breadcrumbs from '@material-ui/core/Breadcrumbs';\nimport I18n from 'i18nline/lib/i18n';\nimport { Link } from 'react-router-dom';\nimport Paper from '@material-ui/core/Paper';\n\n/**\n * NavLines is a component for showing currently selected transport line.\n * It allows also to go back in navigation.\n */\nclass NavLines extends Component {\n\trender() {\n\t\tconst line = this.props.selectedLine && this.props.lines && this.props.lines[this.props.selectedLine] ? this.props.lines[this.props.selectedLine] : null;\n\t\tconst trip = line && this.props.selectedTrip && line.trips[this.props.selectedTrip] ? line.trips[this.props.selectedTrip] : null;\n\t\tconst stLink = {textDecoration: \"none\", color: \"inherit\"}\n\n\t\treturn <Paper style={{padding: 10}}><Breadcrumbs separator=\" / \" aria-label=\"Breadcrumb\" style={{display: \"flex\", justifyContent: \"center\"}}>\n\t\t\t<Link to=\"/\" style={stLink}>\n\t\t\t\t{I18n.t(\"Home\")}\n\t\t\t</Link>\n\n\t\t\t{line && line.rawTags.route_master &&\n\t\t\t\t<Link to={\"/line/\"+this.props.selectedLine} style={stLink}>\n\t\t\t\t\t{I18n.t(\"Line\")}\n\t\t\t\t\t<transport-thumbnail\n\t\t\t\t\t\tdata-transport-mode={line.type}\n\t\t\t\t\t\tdata-transport-line-code={line.ref}\n\t\t\t\t\t\tdata-transport-line-color={line.colour}>\n\t\t\t\t\t</transport-thumbnail>\n\t\t\t\t</Link>\n\t\t\t}\n\n\t\t\t{line && !line.rawTags.route_master && !trip &&\n\t\t\t\t<Link to={\"/line/\"+this.props.selectedLine} style={stLink}>\n\t\t\t\t\t{I18n.t(\"Trip\")}\n\t\t\t\t\t<transport-thumbnail\n\t\t\t\t\t\tdata-transport-mode={line.type}\n\t\t\t\t\t\tdata-transport-line-code={line.ref}\n\t\t\t\t\t\tdata-transport-line-color={line.colour}\n\t\t\t\t\t\tdata-transport-destination={line.to}>\n\t\t\t\t\t</transport-thumbnail>\n\t\t\t\t</Link>\n\t\t\t}\n\n\t\t\t{line && trip &&\n\t\t\t\t<Link to={\"/line/\"+this.props.selectedLine+\"/trip/\"+this.props.selectedTrip} style={stLink}>\n\t\t\t\t\t{I18n.t(\"Trip\")}\n\t\t\t\t\t<transport-thumbnail\n\t\t\t\t\t\tdata-transport-mode={line.type}\n\t\t\t\t\t\tdata-transport-line-code={line.ref}\n\t\t\t\t\t\tdata-transport-line-color={line.colour}\n\t\t\t\t\t\tdata-transport-destination={trip.to}>\n\t\t\t\t\t</transport-thumbnail>\n\t\t\t\t</Link>\n\t\t\t}\n\t\t</Breadcrumbs></Paper>;\n\t}\n}\n\nexport default NavLines;\n","import React, { Component } from 'react';\nimport Button from '@material-ui/core/Button';\nimport I18n from 'i18nline/lib/i18n';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport PubSub from 'pubsub-js';\n\nconst ID_URL = \"https://openstreetmap.org/edit\";\nconst JOSM_URL = \"http://localhost:8111\";\n\nMath.toRadians = function(degrees) {\n\treturn degrees * Math.PI / 180;\n};\n\nMath.toDegrees = function(radians) {\n\treturn radians * 180 / Math.PI;\n};\n\n/**\n * EditorsMenu component display editor selection menu, and launch appropriate action.\n */\nclass EditorsMenu extends Component {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.state = {\n\t\t\topen: false,\n\t\t\tanchor: false\n\t\t};\n\t}\n\n\t/**\n\t * Close the menu\n\t * @private\n\t */\n\t_onClose() {\n\t\tthis.setState({ open: false, anchor: null });\n\t}\n\n\t/**\n\t * Opens and zoom in JOSM on current picture area.\n\t * @private\n\t */\n\t_editJOSM() {\n\t\tlet url = JOSM_URL + \"/load_object?\";\n\n\t\tif(this.props.relation) {\n\t\t\turl += \"&objects=r\" + this.props.relation + \"&relation_members=true\";\n\t\t}\n\n\t\tfetch(url)\n\t\t.then(response => {\n\t\t\tPubSub.publish(\"UI.MESSAGE.BASIC\", { type: \"info\", message: I18n.t(\"Opened in JOSM\") });\n\t\t})\n\t\t.catch(error => {\n\t\t\tconsole.error(error);\n\t\t\tPubSub.publish(\"UI.MESSAGE.BASIC\", { type: \"error\", message: I18n.t(\"Can't open in JOSM, are you sure remote control is enabled ?\") });\n\t\t});\n\t}\n\n\t/**\n\t * Opens ID editor on current picture area.\n\t * @private\n\t */\n\t_editId() {\n\t\tlet url = ID_URL + \"#\";\n\n\t\tconst params = {\n// \t\t\tmap: \"21/\"+this.props.feature.coordinates.join(\"/\"),\n\t\t\thashtags: \"#\"+window.EDITOR_NAME.replace(/ /g, \"_\")\n\t\t};\n\n\t\tif(this.props.relation) {\n\t\t\tparams.id = \"r\"+this.props.relation;\n\t\t}\n\n\t\turl += Object.entries(params).map(p => p[0] + \"=\" + encodeURIComponent(p[1])).join(\"&\");\n\n\t\twindow.open(\n\t\t\turl,\n\t\t\t\"_blank\"\n\t\t).focus();\n\t}\n\n\t_click(editor) {\n\t\tthis._onClose();\n\t\tswitch(editor) {\n\t\t\tcase \"id\":\n\t\t\t\tthis._editId();\n\t\t\t\tbreak;\n\t\t\tcase \"josm\":\n\t\t\t\tthis._editJOSM();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\t}\n\n\trender() {\n\t\tconst editors = [\n// \t\t\t{ id: \"id\", name: I18n.t(\"iD\"), tip: I18n.t(\"Recommended, simplest one\") },\n\t\t\t{ id: \"josm\", name: I18n.t(\"JOSM\"), tip: I18n.t(\"Most complete one\") }\n\t\t];\n\n\t\treturn <div style={{display: \"inline-block\"}}>\n\t\t\t<Button\n\t\t\t\tonClick={e => {\n\t\t\t\t\tif(editors.length > 1) {\n\t\t\t\t\t\tthis.setState({ open: true, anchor: e.currentTarget });\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis._click(editors[0].id);\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{editors.length > 1 ? I18n.t(\"Edit in external editor\") : I18n.t(\"Edit in %{editor}\", { editor: editors[0].name })}\n\t\t\t</Button>\n\n\t\t\t{editors.length > 1 && this.state.anchor &&\n\t\t\t\t<Menu\n\t\t\t\t\tid=\"editors-menu\"\n\t\t\t\t\tanchorEl={this.state.anchor}\n\t\t\t\t\topen={this.state.open}\n\t\t\t\t\tkeepMounted\n\t\t\t\t\tonClose={() => this._onClose()}\n\t\t\t\t>\n\t\t\t\t\t{editors.map(e => {\n\t\t\t\t\t\treturn <MenuItem key={e.id} onClick={() => this._click(e.id)}><ListItemText primary={e.name} secondary={e.tip} /></MenuItem>\n\t\t\t\t\t})}\n\t\t\t\t</Menu>\n\t\t\t}\n\t\t</div>;\n\t}\n}\n\nexport default EditorsMenu;\n","import React, { Component } from 'react';\nimport I18n from 'i18nline/lib/i18n';\nimport Paper from '@material-ui/core/Paper';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\n\n/**\n * TagsTable is a component for displaying OSM feature tags as a table.\n */\nclass TagsTable extends Component {\n\trender() {\n\t\treturn <Paper style={Object.assign({overflowX: \"auto\"}, this.props.style)}>\n\t\t\t<Table>\n\t\t\t\t<TableHead>\n\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t<TableCell>{I18n.t(\"Key\")}</TableCell>\n\t\t\t\t\t\t<TableCell>{I18n.t(\"Value\")}</TableCell>\n\t\t\t\t\t</TableRow>\n\t\t\t\t</TableHead>\n\t\t\t\t\n\t\t\t\t<TableBody>\n\t\t\t\t\t{Object.entries(this.props.tags).map((e, i) => (\n\t\t\t\t\t\t<TableRow key={i}>\n\t\t\t\t\t\t\t<TableCell>{e[0]}</TableCell>\n\t\t\t\t\t\t\t<TableCell>{e[1]}</TableCell>\n\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t))}\n\t\t\t\t</TableBody>\n\t\t\t</Table>\n\t\t</Paper>;\n\t}\n}\n\nexport default TagsTable;\n","import React, { Component } from 'react';\nimport Button from '@material-ui/core/Button';\nimport CONFIG from '../config/config.json';\nimport EditorsMenu from './EditorsMenu';\nimport I18n from 'i18nline/lib/i18n';\nimport InAlert from './InAlert';\nimport TagsTable from './TagsTable';\n\n/**\n * SummaryTripLine is a component which displays a summary of given line/trip.\n * It allows to open external editor.\n */\nclass SummaryTripLine extends Component {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.state = {\n\t\t\tshowTags: false\n\t\t};\n\t}\n\n\trender() {\n\t\tconst line = this.props.selectedLine && this.props.lines && this.props.lines[this.props.selectedLine] ? this.props.lines[this.props.selectedLine] : null;\n\t\tconst trip = line && this.props.selectedTrip && line.trips[this.props.selectedTrip] ? line.trips[this.props.selectedTrip] : null;\n\t\tconst linetrip = trip || line;\n\n\t\treturn <div>\n\t\t\t<h2>\n\t\t\t\t<transport-thumbnail\n\t\t\t\t\tdata-transport-mode={line.type}\n\t\t\t\t\tdata-transport-line-code={line.ref}\n\t\t\t\t\tdata-transport-line-color={line.colour}>\n\t\t\t\t</transport-thumbnail>\n\t\t\t\t{trip ?\n\t\t\t\t\ttrip.name\n\t\t\t\t\t:\n\t\t\t\t\tline.name\n\t\t\t\t}\n\t\t\t</h2>\n\n\t\t\t<ul>\n\t\t\t\t<li>{I18n.t(\"Network\") + \" : \" + (line.network ? line.network : I18n.t(\"not set\"))}</li>\n\t\t\t\t<li>{I18n.t(\"Operator\") + \" : \" + (line.operator ? line.operator : I18n.t(\"not set\"))}</li>\n\t\t\t</ul>\n\n\t\t\t{linetrip && !isNaN(linetrip.defaultInterval) && linetrip.opens === \"unset\" &&\n\t\t\t\t<InAlert message={I18n.t(\"This line has no opening hours defined, existing intervals are applied 24/7.\")} />\n\t\t\t}\n\n\t\t\t{linetrip && linetrip.defaultInterval === \"unset\" && linetrip.otherIntervals === \"unset\" && typeof linetrip.opens === \"object\" &&\n\t\t\t\t<InAlert message={I18n.t(\"This line has no interval defined, but its opening hours are:\")+\" \"+linetrip.rawTags.opening_hours} />\n\t\t\t}\n\n\t\t\t{linetrip && (linetrip.defaultInterval === \"invalid\" || linetrip.otherIntervals === \"invalid\" || linetrip.opens === \"invalid\") &&\n\t\t\t\t<InAlert level=\"warning\" message={I18n.t(\"Some attributes of this line are invalid, please check and correct hours.\")} />\n\t\t\t}\n\n\t\t\t{this.state.showTags &&\n\t\t\t\t<TagsTable tags={trip ? trip.rawTags : line.rawTags} style={{marginBottom: 20}}/>\n\t\t\t}\n\n\t\t\t<div style={{textAlign: \"right\"}}>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => this.setState({ showTags: !this.state.showTags })}\n\t\t\t\t>\n\t\t\t\t\t{this.state.showTags ? I18n.t(\"Hide tags\") : I18n.t(\"See all tags\")}\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\thref={CONFIG.osm_api_url+\"/relation/\"+(trip ? this.props.selectedTrip : this.props.selectedLine)}\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t>\n\t\t\t\t\t{I18n.t(\"See on OSM.org\")}\n\t\t\t\t</Button>\n\n\t\t\t\t<EditorsMenu relation={this.props.selectedTrip || this.props.selectedLine} />\n\t\t\t</div>\n\t\t</div>;\n\t}\n}\n\nexport default SummaryTripLine;\n","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport ContentLineTrip from './ContentLineTrip';\nimport I18n from 'i18nline/lib/i18n';\nimport { Prompt } from 'react-router';\nimport NavLines from './NavLines';\nimport SummaryLineTrip from './SummaryLineTrip';\n\n/**\n * LineTrip component manages the whole display of lines or trips.\n */\nclass LineTrip extends Component {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.state = {\n\t\t\tedits: null\n\t\t};\n\t}\n\n\trender() {\n\t\tconst theProps = Object.assign({}, this.props, {\n\t\t\tselectedLine: this.props.match.params.lid,\n\t\t\tselectedTrip: this.props.match.params.tid\n\t\t});\n\n\t\treturn theProps.selectedLine && theProps.lines && theProps.lines[theProps.selectedLine] ? <div>\n\t\t\t<Prompt\n\t\t\t\twhen={this.state.edits !== null}\n\t\t\t\tmessage={I18n.t(\"You have unsaved edits, if you leave these edits will be lost. Are you sure you want to leave the page ?\")}\n\t\t\t/>\n\n\t\t\t<NavLines {...theProps} />\n\t\t\t<SummaryLineTrip {...theProps} />\n\n\t\t\t<ContentLineTrip\n\t\t\t\t{...theProps}\n\t\t\t\tedits={this.state.edits}\n\t\t\t\tonEdit={periods => this.setState({ edits: periods })}\n\t\t\t/>\n\t\t</div> : <div></div>;\n\t}\n\n\t/**\n\t * Redirects to loader if relation data is missing\n\t * @private\n\t */\n\t_checkDataLoaded() {\n\t\tif(!this.props.match.params.lid || !this.props.lines || !this.props.lines[this.props.match.params.lid]) {\n\t\t\tthis.props.history.push(\"/load/\"+this.props.match.params.lid);\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tthis._checkDataLoaded();\n\t}\n\n\tcomponentDidUpdate() {\n\t\tthis._checkDataLoaded();\n\t}\n}\n\nexport default withRouter(LineTrip);\n","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport I18n from 'i18nline/lib/i18n';\nimport PubSub from 'pubsub-js';\n\n/**\n * Login dialog component informs user on the login procedure of OpenStreetMap.\n * It allows user to go to connect page on OSM, or create an account.\n */\nclass LoginDialogComponent extends Component {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.state = {\n\t\t\topen: false\n\t\t};\n\n\t\t/**\n\t\t * Event when the user wants to login.\n\t\t * @event APP.USER.WANTSLOGIN\n\t\t */\n\t\tPubSub.subscribe(\"APP.USER.WANTSLOGIN\", (msg, data) => {\n\t\t\tdata = data || {};\n\t\t\tthis.setState({ open: true });\n\t\t});\n\t}\n\n\t/**\n\t * Handler for login button click.\n\t * @private\n\t */\n\t_loginClicked() {\n\t\tPubSub.publish(\"APP.USER.LOGIN\");\n\t\tthis._closeDialog(false);\n\t}\n\n\t/**\n\t * Handler for closing dialog\n\t * @private\n\t */\n\t_closeDialog(backToHome) {\n\t\tthis.setState({ open: false });\n\n\t\tif(backToHome && this.props.history) {\n\t\t\tthis.props.history.push('/');\n\t\t}\n\t}\n\n\trender() {\n\t\treturn <Dialog\n\t\t\topen={this.state.open}\n\t\t\tonClose={() => this._closeDialog(true)}\n\t\t>\n\t\t\t<DialogTitle>{I18n.t(\"Connect to OpenStreetMap\")}</DialogTitle>\n\t\t\t<DialogContent>\n\t\t\t\t<DialogContentText>\n\t\t\t\t\t{I18n.t(\"%{editor} uses OpenStreetMap accounts. Please connect to OSM or create an account in order to be able to contribute.\", { editor: window.EDITOR_NAME })}\n\t\t\t\t</DialogContentText>\n\t\t\t</DialogContent>\n\t\t\t<DialogActions>\n\t\t\t\t<Button onClick={() => this._closeDialog(true)} color=\"default\">\n\t\t\t\t\t{I18n.t(\"Cancel\")}\n\t\t\t\t</Button>\n\t\t\t\t<Button onClick={() => this._loginClicked()} color=\"primary\" autoFocus>\n\t\t\t\t\t{I18n.t(\"Login or create account\")}\n\t\t\t\t</Button>\n\t\t\t</DialogActions>\n\t\t</Dialog>;\n\t}\n}\n\nexport default withRouter(LoginDialogComponent);\n","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport I18n from 'i18nline/lib/i18n';\nimport IconButton from '@material-ui/core/IconButton';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport { Link } from 'react-router-dom';\nimport Magnify from 'mdi-react/MagnifyIcon';\nimport TextField from '@material-ui/core/TextField';\nimport Typography from '@material-ui/core/Typography';\n\n/**\n * Welcome component is the main page content.\n * From there you can search for a particular relation.\n */\nclass Welcome extends Component {\n\tconstructor() {\n\t\tsuper();\n\t\t\n\t\tthis.state = {\n\t\t\tsearchText: \"\"\n\t\t};\n\t}\n\t\n\trender() {\n\t\treturn <div>\n\t\t\t<div style={{marginTop: 30, marginBottom: 30}}>\n\t\t\t\t<Typography>{I18n.t(\"Busy Hours is a public transport editor for OpenStreetMap. You can easily edit details of public transport lines.\")}</Typography>\n\t\t\t\t<Typography>{I18n.t(\"To start, enter a transport line relation ID in the search field below.\")}</Typography>\n\t\t\t</div>\n\t\t\t\n\t\t\t<TextField\n\t\t\t\tid=\"relation-id-field\"\n\t\t\t\ttype=\"number\"\n\t\t\t\tplaceholder=\"1234567\"\n\t\t\t\tvariant=\"outlined\"\n\t\t\t\tlabel={I18n.t(\"Relation ID\")}\n\t\t\t\tstyle={{width: \"100%\"}}\n\t\t\t\tvalue={this.state.searchText}\n\t\t\t\tonChange={e => this.setState({ searchText: e.target.value })}\n\t\t\t\tInputProps={{\n\t\t\t\t\tendAdornment: (\n\t\t\t\t\t\t<InputAdornment position=\"end\">\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tcomponent={Link}\n\t\t\t\t\t\t\t\tto={\"/load/\"+this.state.searchText.trim()}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Magnify />\n\t\t\t\t\t\t\t</IconButton>\n\t\t\t\t\t\t</InputAdornment>\n\t\t\t\t\t)\n\t\t\t\t}}\n\t\t\t/>\n\t\t</div>;\n\t}\n}\n\nexport default withRouter(Welcome);\n","import React, { Component } from 'react';\nimport { HashRouter, Switch, Route } from 'react-router-dom';\nimport 'typeface-roboto';\nimport 'jungle_bus_web_components';\nimport { createMuiTheme } from '@material-ui/core/styles';\nimport { ThemeProvider } from '@material-ui/styles';\nimport { MuiPickersUtilsProvider } from '@material-ui/pickers';\nimport Alert from './Alert';\nimport Container from '@material-ui/core/Container';\nimport DataLoader from './DataLoader';\nimport DateFnsUtils from '@date-io/date-fns';\nimport blue from '@material-ui/core/colors/blue';\nimport orange from '@material-ui/core/colors/orange';\nimport Header from './Header';\nimport LineTrip from './LineTrip';\nimport LoginDialog from './LoginDialog';\nimport Welcome from './Welcome';\n\n/**\n * Body is the view main class.\n * It creates all other component in cascade.\n */\nclass Body extends Component {\n\tconstructor() {\n\t\tsuper();\n\n\t\t// Set main colors of app\n\t\tthis._theme = createMuiTheme({\n\t\t\tpalette: {\n\n\t\t\t\tprimary: blue,\n\n\t\t\t\tsecondary: {\n\t\t\t\t\tlight: orange[500],\n\t\t\t\t\tmain: orange[800],\n\t\t\t\t\tdark: orange[900]\n\t\t\t\t},\n\n\t\t\t}\n\t\t});\n\n\t\tthis.state = {};\n\t}\n\n\t_onDataLoaded(newData) {\n\t\tthis.setState({ lines: newData });\n\t\tconsole.log(\"Loaded data\", newData);\n\t}\n\n\trender() {\n\t\treturn <HashRouter>\n\t\t\t<MuiPickersUtilsProvider utils={DateFnsUtils}>\n\t\t\t\t<ThemeProvider theme={this._theme}>\n\t\t\t\t\t<Header {...this.state} />\n\n\t\t\t\t\t<Container maxWidth=\"md\" style={{marginTop: 20, marginBottom: 20}}><Switch>\n\t\t\t\t\t\t<Route exact path='/' component={Welcome} />\n\n\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\texact\n\t\t\t\t\t\t\tpath={this.state.lines ? '/load/:rid' : ['/load/:rid', '/line/:rid', '/line/:lid/trip/:rid' ]}\n\t\t\t\t\t\t\trender={props => (\n\t\t\t\t\t\t\t\t<DataLoader\n\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t{...this.props}\n\t\t\t\t\t\t\t\t\tonDataLoaded={d => this._onDataLoaded(d)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t{this.state.lines && [\n\t\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\t\tkey={0}\n\t\t\t\t\t\t\t\texact path='/line/:lid'\n\t\t\t\t\t\t\t\trender={props => <LineTrip {...this.state} {...this.props} />}\n\t\t\t\t\t\t\t/>,\n\t\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\t\tkey={1}\n\t\t\t\t\t\t\t\texact path='/line/:lid/trip/:tid'\n\t\t\t\t\t\t\t\trender={props => <LineTrip {...this.state} {...this.props} />}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t]}\n\t\t\t\t\t</Switch></Container>\n\n\t\t\t\t\t<LoginDialog />\n\n\t\t\t\t\t<Alert />\n\t\t\t\t</ThemeProvider>\n\t\t\t</MuiPickersUtilsProvider>\n\t\t</HashRouter>;\n\t}\n}\n\nexport default Body;\n","import CONFIG from '../config/config.json';\nimport OsmRequest from 'osm-request';\nimport PACKAGE from '../../package.json';\nimport TransportHours from 'transport-hours';\n\nconst VALID_MODES = [ \"bus\", \"coach\", \"train\", \"subway\", \"monorail\", \"trolleybus\", \"aerialway\", \"funicular\", \"ferry\", \"tram\", \"share_taxi\", \"light_rail\", \"walking_bus\" ];\n\n/**\n * DataManager allows to communicate with OSM API.\n * It retrieves relations data, and allows to edit them back.\n */\nclass DataManager {\n\tconstructor() {\n\t\t// Create OSM Request\n\t\tthis._osmApi = new OsmRequest({\n\t\t\tendpoint: CONFIG.osm_api_url,\n\t\t\toauthConsumerKey: CONFIG.oauth_consumer_key,\n\t\t\toauthSecret: CONFIG.oauth_secret\n\t\t});\n\n\t\tthis._transportHours = new TransportHours();\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_getRelNumber(relid) {\n\t\treturn relid.split(\"/\")[1];\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_createSimplifiedLineTrip(relid, reltags, trips) {\n\t\tif(relid.includes(\"/\")) { relid = relid.split(\"/\")[1]; }\n\n\t\tconst result = Object.assign(\n\t\t\t{\n\t\t\t\tref: reltags.ref,\n\t\t\t\tname: reltags.name,\n\t\t\t\tcolour: reltags.colour,\n\t\t\t\tnetwork: reltags.network,\n\t\t\t\toperator: reltags.operator,\n\t\t\t\trawTags: reltags\n\t\t\t},\n\t\t\tthis._transportHours.tagsToHoursObject(reltags)\n\t\t);\n\n\t\tif(reltags.type === \"route\") {\n\t\t\tresult.type = reltags.route;\n\t\t\tresult.from = reltags.from;\n\t\t\tresult.to = reltags.to;\n\t\t}\n\t\telse {\n\t\t\tresult.type = reltags.route_master;\n\t\t\tresult.trips = trips;\n\t\t}\n\n\t\treturn { [relid]: result };\n\t}\n\n\t/**\n\t * Load all data related to given relation.\n\t * If relation is a route, loads route_master and all other routes.\n\t * If relation is a route_master, loads all routes in it.\n\t * @param {string} relationId The relation to load (example : \"relation/1234\")\n\t * @return {Promise} Resolves on loaded data (ready to use)\n\t */\n\tloadDataFromRelation(relationId) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis._osmApi.fetchElement(relationId)\n\t\t\t.then(relation => {\n\t\t\t\tconst relTags = this._osmApi.getTags(relation);\n\t\t\t\tconst transportMode = relTags.type === \"route\" ? relTags.route : relTags.route_master;\n\n\t\t\t\t// Check transport mode\n\t\t\t\tif(VALID_MODES.includes(transportMode)) {\n\t\t\t\t\t// Simple route\n\t\t\t\t\tif(relTags.type === \"route\") {\n\t\t\t\t\t\t// Fetch route_master\n\t\t\t\t\t\tthis._osmApi.fetchRelationsForElement(relationId)\n\t\t\t\t\t\t.then(parentRelations => {\n\t\t\t\t\t\t\tconst routeMasters = parentRelations.filter(r => this._osmApi.getTags(r).type === \"route_master\");\n\n\t\t\t\t\t\t\t// Single route master\n\t\t\t\t\t\t\tif(routeMasters.length === 1) {\n\t\t\t\t\t\t\t\t// Fetch other trips for this line\n\t\t\t\t\t\t\t\tconst otherTripsRel = routeMasters[0].member.filter(m => m.$.type === \"relation\" && m.$.ref !== relationId);\n\n\t\t\t\t\t\t\t\t// Other trips available\n\t\t\t\t\t\t\t\tif(otherTripsRel.length > 0) {\n\t\t\t\t\t\t\t\t\tPromise.all(\n\t\t\t\t\t\t\t\t\t\totherTripsRel.map(tr => this._osmApi.fetchElement(tr.$.type+\"/\"+tr.$.ref))\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t.then(otherTripsData => {\n\t\t\t\t\t\t\t\t\t\tresolve(this._createSimplifiedLineTrip(\n\t\t\t\t\t\t\t\t\t\t\trouteMasters[0].$.id,\n\t\t\t\t\t\t\t\t\t\t\tthis._osmApi.getTags(routeMasters[0]),\n\t\t\t\t\t\t\t\t\t\t\tObject.assign({}, ...otherTripsData.map(t => this._createSimplifiedLineTrip(t.$.id, this._osmApi.getTags(t), null)))\n\t\t\t\t\t\t\t\t\t\t));\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\t\t\t\t\treject(\"cant_get_trips\");\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// No other trips : send back route_master + original route\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tresolve(this._createSimplifiedLineTrip(\n\t\t\t\t\t\t\t\t\t\trouteMasters[0].$.id,\n\t\t\t\t\t\t\t\t\t\tthis._osmApi.getTags(routeMasters[0]),\n\t\t\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\t\tthis._createSimplifiedLineTrip(relationId, relTags, null)\n\t\t\t\t\t\t\t\t\t\t]\n  \t\t\t\t\t\t\t\t\t));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// No route master : trip used as line\n\t\t\t\t\t\t\telse if(routeMasters.length === 0) {\n\t\t\t\t\t\t\t\tresolve(this._createSimplifiedLineTrip(relationId, relTags, null));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\treject(\"many_route_masters\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(e => {\n\t\t\t\t\t\t\treject(e);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t// Route master\n\t\t\t\t\telse if(relTags.type === \"route_master\") {\n\t\t\t\t\t\t// Fetch trips for this line\n\t\t\t\t\t\tconst tripsRel = relation.member.filter(m => m.$.type === \"relation\");\n\n\t\t\t\t\t\t// Other trips available\n\t\t\t\t\t\tif(tripsRel.length > 0) {\n\t\t\t\t\t\t\tPromise.all(\n\t\t\t\t\t\t\t\ttripsRel.map(tr => this._osmApi.fetchElement(tr.$.type+\"/\"+tr.$.ref))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.then(otherTripsData => {\n\t\t\t\t\t\t\t\tresolve(this._createSimplifiedLineTrip(\n\t\t\t\t\t\t\t\t\trelationId,\n\t\t\t\t\t\t\t\t\tthis._osmApi.getTags(relation),\n\t\t\t\t\t\t\t\t\tObject.assign({}, ...otherTripsData.map(t => this._createSimplifiedLineTrip(t.$.id, this._osmApi.getTags(t), null)))\n\t\t\t\t\t\t\t\t));\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\t\t\treject(\"cant_get_trips\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// No other trips : send back route_master + original route\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\treject(\"no_trips\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treject(\"invalid_mode\");\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\treject(e);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Upload period changes made on a relation to OSM.\n\t * @param {string} relationId The relation to update (example : \"relation/1234\")\n\t * @param {Object} allPeriods Object returned by HoursEditor, containing period array (days + intervals)\n\t * @return {Promise} Resolves on successful upload\n\t */\n\tasync saveRelationPeriods(relationId, allPeriods) {\n\t\t// Check if user is authenticated\n\t\tif(!window.editor_user || !window.editor_user_auth) {\n\t\t\treturn new Error(\"not_connected\");\n\t\t}\n\t\tthis._osmApi._auth = window.editor_user_auth;\n\n\t\t// Convert editor data into tags\n\t\tlet newTags;\n\t\ttry {\n\t\t\tnewTags = this._transportHours.intervalsObjectToTags(allPeriods);\n\t\t}\n\t\tcatch(e) {\n\t\t\treturn e;\n\t\t}\n\n\t\t// Retrieve data from OSM server (to ensure we have latest version)\n\t\tlet osmElement;\n\t\ttry {\n\t\t\tosmElement = await this._osmApi.fetchElement(relationId);\n\t\t\tif(!osmElement) { throw new Error(); }\n\t\t}\n\t\tcatch(e) {\n\t\t\tconsole.error(e);\n\t\t\treturn new Error(\"cant_find_relation\");\n\t\t}\n\n\t\t// Create changeset\n\t\tlet changesetId;\n\t\ttry {\n\t\t\tchangesetId = await this._osmApi.createChangeset(\n\t\t\t\twindow.EDITOR_NAME+' '+PACKAGE.version,\n\t\t\t\t\"Changed hours/interval of public transport route \"+relationId,\n\t\t\t\t{ host: window.EDITOR_URL }\n\t\t\t);\n\t\t}\n\t\tcatch(e) {\n\t\t\tconsole.error(e);\n\t\t\treturn new Error(\"changeset_failed\");\n\t\t}\n\n\t\t// Send data to OSM\n\t\tif(newTags && changesetId && osmElement) {\n\t\t\tosmElement = this._osmApi.setTags(osmElement, newTags);\n\t\t\tosmElement = this._osmApi.setTimestampToNow(osmElement);\n\n\t\t\tlet result;\n\t\t\ttry {\n\t\t\t\tresult = await this._osmApi.sendElement(osmElement, changesetId);\n\t\t\t\tif(isNaN(result)) {\n\t\t\t\t\tthrow new Error(\"Version number invalid\", result);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch(e) {\n\t\t\t\tconsole.error(e);\n\t\t\t\treturn new Error(\"sending_failed\");\n\t\t\t}\n\n\t\t\t// Close changeset\n\t\t\ttry {\n\t\t\t\tawait this._osmApi.closeChangeset(changesetId);\n\t\t\t}\n\t\t\tcatch(e) {\n\t\t\t\tconsole.error(\"Changeset was not closed, will be automatically closed after 30 minutes\");\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t}\n}\n\nexport default DataManager;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Body from './view/Body';\nimport CONFIG from './config/config.json';\nimport DataManager from './ctrl/DataManager';\nimport I18n from 'i18nline/lib/i18n';\nimport OsmAuth from 'osm-auth';\nimport PubSub from 'pubsub-js';\n\n/*\n * Global variables definition\n */\nwindow.EDITOR_NAME = CONFIG.editor_name;\nconst LOCALES = [ \"en\", \"fr\" ];\nwindow.EDITOR_URL = window.location.origin + window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/')) + \"/\";\n\n/**\n * App is the application starter.\n * It creates mostly everything.\n */\nclass App {\n\tconstructor() {\n\t\tthis._initI18n();\n\t\tthis._initCtrl();\n\t\tthis._initView();\n\t\tthis._initAuth();\n\t}\n\n\t/**\n\t * Initializes internationalization system\n\t * @private\n\t */\n\t_initI18n() {\n\t\tlet locale = null;\n\t\tif(window.navigator.languages) {\n\t\t\tfor(const l of window.navigator.languages) {\n\t\t\t\tif(LOCALES.includes(l)) {\n\t\t\t\t\tlocale = l;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tI18n.locale = locale || window.navigator.userLanguage || window.navigator.language;\n\t\tI18n.fallbacks = true;\n\n\t\t//Load translation files\n\t\tfor(const l of LOCALES) {\n\t\t\tObject.assign(I18n.translations, require(\"./config/locales/\"+l.replace(\"-\", \"_\")+\".json\"));\n\t\t}\n\t}\n\n\t/**\n\t * Creates controller objects.\n\t * @private\n\t */\n\t_initCtrl() {\n\t\tthis._dataManager = new DataManager();\n\t}\n\n\t/**\n\t * Create view components\n\t * @private\n\t */\n\t_initView() {\n\t\tReactDOM.render(<Body dataManager={this._dataManager} />, document.getElementById('root'));\n\t\tdocument.title=window.EDITOR_NAME;\n\t}\n\n\t/**\n\t * Launches authentication process\n\t * @private\n\t */\n\t_initAuth() {\n\t\tconst opts = {\n\t\t\turl: CONFIG.osm_api_url,\n\t\t\toauth_consumer_key: CONFIG.oauth_consumer_key,\n\t\t\toauth_secret: CONFIG.oauth_secret,\n\t\t\tlanding: window.EDITOR_URL + window.location.hash,\n\t\t\tsinglepage: true\n\t\t};\n\t\twindow.editor_user_auth = OsmAuth(opts);\n\n\t\tconst params = this._readURLParams(window.location.href);\n\t\tconst token = params.oauth_token || localStorage.getItem(\"oauth_token\") || null;\n\n\t\tif(token) {\n\t\t\twindow.editor_user_auth.bootstrapToken(token, () => {\n\t\t\t\tthis._checkAuth();\n\t\t\t\twindow.history.pushState({}, \"\", window.location.href.replace(\"?oauth_token=\"+token, \"\"));\n\t\t\t\tlocalStorage.setItem(\"oauth_token\", token);\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\t//Check if we receive auth token\n\t\t\tthis._checkAuth();\n\t\t\tthis.authWait = setInterval(this._checkAuth.bind(this), 100);\n\t\t}\n\n\t\t/**\n\t\t * Event for logging in user\n\t\t * @event APP.USER.LOGIN\n\t\t * @memberof App\n\t\t */\n\t\tPubSub.subscribe(\"APP.USER.LOGIN\", (msg, data) => {\n\t\t\topts.landing = window.EDITOR_URL + window.location.hash;\n\t\t\twindow.editor_user_auth.options(opts);\n\n\t\t\tif(!window.editor_user_auth.authenticated()) {\n\t\t\t\twindow.editor_user_auth.authenticate((err, res) => {\n\t\t\t\t\tif(err) {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\talert(I18n.t(\"Oops ! Something went wrong when trying to log you in\"));\n\t\t\t\t\t\tPubSub.publish(\"APP.USER.LOGOUT\");\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis._checkAuth();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Event for logging out user\n\t\t * @event APP.USER.LOGOUT\n\t\t * @memberof App\n\t\t */\n\t\tPubSub.subscribe(\"APP.USER.LOGOUT\", (msg, data) => {\n\t\t\tif(window.editor_user_auth && window.editor_user_auth.authenticated()) {\n\t\t\t\twindow.editor_user_auth.logout();\n\t\t\t}\n\n\t\t\twindow.editor_user = null;\n\t\t\tlocalStorage.removeItem(\"oauth_token\");\n\t\t});\n\t}\n\n\t/**\n\t * Check if authentication happened\n\t * @private\n\t */\n\t_checkAuth() {\n\t\tif(window.editor_user_auth.authenticated()) {\n\t\t\tif(this.authWait) {\n\t\t\t\tclearInterval(this.authWait);\n\t\t\t}\n\n\t\t\t//Get user details\n\t\t\twindow.editor_user_auth.xhr({\n\t\t\t\tmethod: 'GET',\n\t\t\t\tpath: '/api/0.6/user/details'\n\t\t\t}, (err, details) => {\n\t\t\t\tif(err) {\n\t\t\t\t\tconsole.log(err);\n\t\t\t\t\twindow.editor_user_auth.logout();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\ttry {\n\t\t\t\t\t\twindow.editor_user = {\n\t\t\t\t\t\t\tid: details.firstChild.childNodes[1].attributes.id.value,\n\t\t\t\t\t\t\tname: details.firstChild.childNodes[1].attributes.display_name.value,\n\t\t\t\t\t\t\tauth: window.editor_user_auth\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Event when user has been successfully logged in\n\t\t\t\t\t\t * @event APP.USER.READY\n\t\t\t\t\t\t * @memberof App\n\t\t\t\t\t\t */\n\t\t\t\t\t\tPubSub.publish(\"APP.USER.READY\", { username: window.editor_user.name });\n\t\t\t\t\t\tconsole.log(\"Logged in as\", window.editor_user.name);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\tPubSub.publish(\"APP.USER.LOGOUT\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Parse URL parameters\n\t * @private\n\t */\n\t_readURLParams(str) {\n\t\tconst u = str.split('?');\n\n\t\tif(u.length > 1) {\n\t\t\tconst p = u[1].split('#')[0];\n\n\t\t\treturn p.split('&').filter(function (pair) {\n\t\t\t\treturn pair !== '';\n\t\t\t}).reduce(function(obj, pair){\n\t\t\t\tvar parts = pair.split('=');\n\t\t\t\tobj[decodeURIComponent(parts[0])] = (null === parts[1]) ?\n\t\t\t\t\t'' : decodeURIComponent(parts[1]);\n\t\t\t\treturn obj;\n\t\t\t}, {});\n\t\t}\n\t\telse {\n\t\t\treturn {};\n\t\t}\n\t}\n}\n\n// Create app\nnew App();\n"],"sourceRoot":""}